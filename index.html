<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>YouTube Trails v5.4.12 - Dynamic Z-Index: Chips Hide Behind Expanded Slider 🚀</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --yt-black: #0F0F0F;
            --yt-white: #FFFFFF;
            --yt-red: #FF0000;
            --yt-blue: #065FD4;
            --yt-text-primary: #0F0F0F;
            --yt-text-secondary: #606060;
            --yt-divider: #0000001a;
            --yt-hover: #0000000d;
            --yt-overlay: #000000cc;
        }

        body {
            font-family: 'Roboto', Arial, sans-serif;
            background: #f5f5f5;
            color: var(--yt-text-primary);
            -webkit-font-smoothing: antialiased;
        }

        .phone-container {
            max-width: 428px;
            margin: 20px auto;
            background: white;
            border-radius: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: visible; /* Changed from hidden to allow tooltips outside */
            height: 800px;
            position: relative;
        }

        .app {
            height: 100%;
            display: flex;
            flex-direction: column;
            background: var(--yt-white);
            border-radius: 40px; /* Moved border radius here to maintain rounded corners */
            overflow: hidden; /* Clip content but tooltips are outside .app */
        }

        /* YouTube Header */
        .yt-header {
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 16px;
            background: var(--yt-white);
            border-bottom: 1px solid var(--yt-divider);
            z-index: 50; /* Lower than toggle bar and chips to not cover tooltips */
        }

        .yt-logo {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .yt-logo-icon {
            width: 32px;
            height: 32px;
            background: var(--yt-red);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 14px;
            transition: background 0.3s ease;
        }

        .yt-logo-icon.trail-mode {
            background: var(--yt-blue);
        }

        .yt-logo-text {
            font-size: 18px;
            font-weight: 500;
            letter-spacing: -0.5px;
        }

        .yt-logo-trails {
            font-size: 12px;
            color: var(--yt-blue);
            font-weight: 500;
            margin-left: 4px;
        }

        .yt-header-actions {
            display: flex;
            gap: 8px;
        }

        .yt-icon-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.2s;
            border: none;
            background: transparent;
        }

        .yt-icon-btn:hover {
            background: var(--yt-hover);
        }

        .material-icons {
            font-size: 24px;
            color: var(--yt-text-primary);
        }

        /* Back Button Header */
        .yt-header-back {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .yt-header-title {
            font-size: 20px;
            font-weight: 500;
        }

        /* Trail Toggle Bar - Compact with Slider */
        .trail-toggle-bar {
            position: sticky;
            top: 0;
            z-index: 250; /* Increased from 100 to ensure tooltips show above other elements */
            padding: 20px 16px 8px 16px; /* Increased top padding for tooltip */
            background: var(--yt-white);
            border-bottom: 1px solid var(--yt-divider);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            overflow: visible; /* Allow tooltip to show above */
        }

        .toggle-group {
            display: flex;
            align-items: center;
            gap: 6px;
            flex-shrink: 0;
            position: relative; /* For tooltip positioning */
        }

        .toggle-label {
            font-size: 13px;
            color: var(--yt-text-secondary);
            font-weight: 400;
        }

        .toggle-label.active {
            color: var(--yt-text-primary);
            font-weight: 500;
        }

        .yt-toggle {
            position: relative;
            width: 40px;
            height: 24px;
            background: #909090;
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .yt-toggle.active {
            background: var(--yt-blue);
        }

        .yt-toggle-thumb {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: left 0.2s;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        .yt-toggle.active .yt-toggle-thumb {
            left: 18px;
        }

        .create-trail-btn {
            padding: 8px 16px;
            background: var(--yt-blue);
            color: white;
            border: none;
            border-radius: 18px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        .create-trail-btn:hover {
            background: #0556c4;
        }

        /* Chips Bar - Sticky */
        .yt-chips-bar {
            position: sticky;
            top: 60px;
            z-index: 250; /* Default lower z-index - will be dynamically changed by JS */
            display: flex;
            gap: 8px;
            padding: 12px 16px;
            overflow-x: auto;
            overflow-y: visible; /* Allow tooltips to show above */
            background: var(--yt-white);
            border-bottom: 1px solid var(--yt-divider);
            margin-top: -1px; /* Overlap with slider when expanded */
        }


        .yt-chips-bar::-webkit-scrollbar {
            display: none;
        }

        .yt-chip {
            padding: 8px 12px;
            background: #0000000d;
            border: none;
            border-radius: 16px; /* Material Design standard for chips */
            font-size: 14px;
            font-weight: 500;
            color: var(--yt-text-primary);
            cursor: pointer;
            white-space: nowrap;
            transition: background 0.2s;
            position: relative; /* For tooltip positioning */
        }

        .yt-chip:hover {
            background: #00000014;
        }

        .yt-chip.active {
            background: var(--yt-text-primary);
            color: var(--yt-white);
        }

        /* Content */
        .yt-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: visible; /* Allow tooltips to show outside horizontally */
            background: var(--yt-white);
            position: relative; /* Create stacking context */
        }

        .yt-content::-webkit-scrollbar {
            width: 0;
        }

        /* Banner */
        .yt-banner {
            margin: 12px 16px;
            padding: 16px;
            background: #E8F0FE;
            border-radius: 12px;
            border: 1px solid #C5D9F7;
        }

        .yt-banner-header {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
        }

        .yt-banner-icon {
            font-size: 28px;
        }

        .yt-banner-text h3 {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .yt-banner-text p {
            font-size: 13px;
            color: var(--yt-text-secondary);
            line-height: 18px;
        }

        .yt-banner-actions {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }

        .yt-banner-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 18px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
        }

        .yt-banner-btn-primary {
            background: var(--yt-blue);
            color: white;
        }

        .yt-banner-btn-secondary {
            background: transparent;
            color: var(--yt-blue);
        }

        /* Collapsible Focus Slider - Inline */
        .focus-slider-section {
            background: #F5F5F5;
            border: 1px solid #E0E0E0;
            border-radius: 8px; /* More prominent border radius */
            overflow: visible; /* Changed from hidden - allow tooltips to show */
            transition: all 0.3s ease;
            flex: 1;
            min-width: 0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .focus-slider-section.inline-mode {
            position: relative;
        }

        .focus-slider-section.expanded-mode {
            position: absolute;
            left: 16px;
            right: 16px;
            top: 48px;
            z-index: 350; /* Higher than chips (250) and bottom nav (300) */
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            overflow: visible; /* Allow tooltips in expanded state */
        }
        
        .focus-slider-collapsed {
            padding: 6px 10px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
            border-radius: 4px; /* Material Design standard */
        }

        .focus-slider-collapsed:hover {
            background: #ececec;
        }

        .collapsed-label {
            font-size: 12px;
            font-weight: 500;
            color: var(--yt-text-primary);
            white-space: nowrap;
        }

        .collapsed-value {
            font-size: 12px;
            font-weight: 500;
            color: var(--yt-blue);
            white-space: nowrap;
        }

        .focus-slider-expanded {
            padding: 12px 12px 12px 12px; /* Reduced top padding */
            background: var(--yt-white);
            border: 1px solid #E0E0E0;
            border-radius: 8px;
            position: relative; /* Create positioning context */
            overflow: visible; /* Allow tooltips to show */
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        .slider-close-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 24px;
            height: 24px;
            background: transparent;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--yt-text-secondary);
            font-size: 16px;
            z-index: 10;
        }

        .slider-close-btn:hover {
            background: #F5F5F5;
            color: var(--yt-text-primary);
        }

        .focus-slider-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            align-items: center;
        }

        .focus-slider-label {
            font-size: 14px;
            font-weight: 500;
        }

        .focus-slider-value {
            font-size: 14px;
            font-weight: 500;
            color: var(--yt-blue);
        }

        .slider-container {
            position: relative;
            margin: 12px 0;
        }

        .yt-slider {
            width: 100%;
            height: 4px;
            -webkit-appearance: none;
            background: #E0E0E0;
            border-radius: 2px;
            outline: none;
        }

        .yt-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: var(--yt-blue);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        /* Topic Bubbles */
        .topic-bubbles {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
            position: relative;
            overflow: visible;
        }

        .topic-bubble {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--yt-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .topic-bubble:hover {
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .topic-bubble.active {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Topic Map */
        .topic-map {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            z-index: 1000;
            max-width: 320px;
            width: 90%;
            max-height: 70vh;
            overflow-y: auto;
        }

        .topic-map-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }

        .topic-map-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--yt-divider);
        }

        .topic-map-title {
            font-size: 16px;
            font-weight: 500;
        }

        .topic-map-close {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: transparent;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .topic-map-content {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 16px;
        }

        /* Search box */
        .topic-search {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--yt-divider);
            border-radius: 8px;
            font-size: 13px;
            font-family: 'Roboto', sans-serif;
            margin-bottom: 16px;
        }

        .topic-search:focus {
            outline: none;
            border-color: var(--yt-blue);
        }

        /* Section headers */
        .topic-section-header {
            font-size: 12px;
            font-weight: 500;
            color: var(--yt-text-primary);
            margin-bottom: 10px;
            padding-bottom: 6px;
            border-bottom: 1px solid var(--yt-divider);
        }

        /* Main topics - Radio style */
        .main-topic-item {
            padding: 10px 12px;
            background: #F9F9F9;
            border-radius: 8px;
            font-size: 13px;
            cursor: pointer;
            transition: background 0.15s ease, color 0.15s ease;
            border: 2px solid transparent;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .main-topic-item:hover {
            background: #E8F0FE;
        }

        .main-topic-item.selected {
            background: var(--yt-blue);
            color: white;
            border-color: var(--yt-blue);
        }

        .radio-indicator {
            width: 16px;
            height: 16px;
            border: 2px solid var(--yt-text-secondary);
            border-radius: 50%;
            position: relative;
            flex-shrink: 0;
        }

        .main-topic-item.selected .radio-indicator {
            border-color: white;
        }

        .main-topic-item.selected .radio-indicator::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 6px;
            height: 6px;
            background: white;
            border-radius: 50%;
        }

        /* Meta tags - Checkbox style */
        .meta-tags-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 6px;
            margin-top: 12px;
        }

        .meta-tag-item {
            padding: 8px 10px;
            background: #F9F9F9;
            border-radius: 6px;
            font-size: 11px;
            cursor: pointer;
            transition: background 0.15s ease, border-color 0.15s ease;
            border: 1px solid transparent;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .meta-tag-item:hover {
            background: #E8F0FE;
        }

        .meta-tag-item.selected {
            background: #E8F0FE;
            border-color: var(--yt-blue);
            color: var(--yt-blue);
        }

        .checkbox-indicator {
            width: 14px;
            height: 14px;
            border: 2px solid var(--yt-text-secondary);
            border-radius: 3px;
            position: relative;
            flex-shrink: 0;
        }

        .meta-tag-item.selected .checkbox-indicator {
            background: var(--yt-blue);
            border-color: var(--yt-blue);
        }

        .meta-tag-item.selected .checkbox-indicator::after {
            content: '✓';
            position: absolute;
            top: -2px;
            left: 1px;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        .topic-connections {
            padding: 12px;
            background: #FFF9E6;
            border-radius: 8px;
            margin-top: 12px;
        }

        .topic-connections-title {
            font-size: 11px;
            font-weight: 500;
            color: var(--yt-text-secondary);
            margin-bottom: 8px;
        }

        .connection-item {
            font-size: 11px;
            color: var(--yt-text-secondary);
            padding: 4px 0;
        }

        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 4px;
        }

        .slider-label-text {
            font-size: 12px;
            color: var(--yt-text-secondary);
        }

        .slider-description {
            font-size: 12px;
            color: var(--yt-text-secondary);
            margin-top: 8px;
            text-align: center;
        }

        /* Video Card - Compact Design */
        .yt-video-card {
            margin-bottom: 12px;
            cursor: pointer;
        }

        .yt-thumbnail-container {
            width: 100%;
            aspect-ratio: 16/9;
            position: relative;
            background: #000;
            overflow: hidden;
        }

        .yt-thumbnail {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            color: white;
            font-weight: 500;
            padding: 16px;
            text-align: center;
        }

        .yt-duration {
            position: absolute;
            bottom: 4px;
            right: 4px;
            padding: 2px 4px;
            background: var(--yt-overlay);
            color: white;
            font-size: 12px;
            font-weight: 500;
            border-radius: 2px;
        }

        .yt-trail-badge {
            position: absolute;
            top: 6px;
            left: 6px;
            padding: 3px 6px;
            color: white;
            font-size: 10px;
            font-weight: 500;
            border-radius: 3px;
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .yt-video-info {
            padding: 8px 12px;
            position: relative; /* Create positioning context for tooltips */
            overflow: visible; /* Allow tooltips to show */
        }

        /* Tags at top */
        .yt-video-tags {
            display: flex;
            gap: 4px;
            margin-bottom: 6px;
            flex-wrap: wrap;
        }

        .yt-tag {
            padding: 2px 8px;
            background: #0000000d;
            border-radius: 12px;
            font-size: 11px;
            color: var(--yt-text-secondary);
            font-weight: 400;
        }

        .yt-video-header {
            display: flex;
            gap: 8px;
            margin-bottom: 6px;
        }

        .yt-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .yt-video-details {
            flex: 1;
        }

        .yt-video-title {
            font-size: 13px;
            font-weight: 500;
            line-height: 18px;
            color: var(--yt-text-primary);
            margin-bottom: 2px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .yt-video-meta {
            font-size: 11px;
            color: var(--yt-text-secondary);
            line-height: 16px;
        }

        /* Compact action buttons */
        .yt-video-actions {
            display: flex;
            gap: 6px;
            align-items: center;
            margin-top: 6px;
            position: relative; /* Create positioning context for tooltips */
            overflow: visible; /* Allow tooltips to show */
        }

        .yt-action-btn {
            padding: 4px 10px;
            background: transparent;
            border: 1px solid var(--yt-divider);
            border-radius: 14px;
            font-size: 11px;
            font-weight: 500;
            color: var(--yt-text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 3px;
            white-space: nowrap;
            position: relative; /* For tooltip positioning */
        }

        .yt-action-btn:hover {
            background: var(--yt-hover);
        }

        .yt-action-btn .material-icons {
            font-size: 16px;
        }

        /* Trail Card */
        .yt-trail-card {
            margin: 0 16px 16px 16px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: box-shadow 0.2s;
        }

        .yt-trail-card:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        .yt-trail-thumbnail {
            width: 100%;
            height: 140px;
            position: relative;
            overflow: hidden;
        }

        .trail-thumbnail-content {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .trail-progress-overlay {
            position: absolute;
            top: 12px;
            right: 12px;
        }

        .progress-circle {
            width: 32px;
            height: 32px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }

        .trail-header {
            margin-bottom: 12px;
        }

        .trail-creator-info {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
        }

        .creator-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .creator-details {
            flex: 1;
        }

        .creator-verified {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 11px;
            color: var(--yt-blue);
            margin-top: 2px;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
        }

        .yt-tag-more {
            background: var(--yt-hover);
            color: var(--yt-text-secondary);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        .yt-trail-info {
            padding: 12px;
            background: var(--yt-white);
        }

        .yt-trail-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 4px;
            line-height: 20px;
        }

        .yt-trail-creator {
            font-size: 12px;
            color: var(--yt-text-secondary);
            margin-bottom: 8px;
        }

        .yt-trail-stats {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: var(--yt-text-secondary);
            margin-bottom: 8px;
        }

        .yt-trail-dot {
            width: 3px;
            height: 3px;
            background: var(--yt-text-secondary);
            border-radius: 50%;
        }

        .yt-trail-tags {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        .yt-trail-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 8px;
            border-top: 1px solid var(--yt-divider);
        }

        .yt-focus-badge {
            padding: 4px 8px;
            background: var(--yt-blue);
            color: white;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
        }

        .yt-skill-badge {
            font-size: 12px;
            color: var(--yt-text-secondary);
        }

        /* Section Header */
        .yt-section-header {
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .yt-section-title {
            font-size: 18px;
            font-weight: 500;
        }

        /* Bottom Nav */
        .yt-bottom-nav {
            height: 56px;
            display: flex;
            background: var(--yt-white);
            border-top: 1px solid var(--yt-divider);
            position: relative; /* Create positioning context */
            overflow: visible; /* Allow tooltips to show above */
            z-index: 300; /* High z-index to ensure tooltips show above all content */
        }

        .yt-nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 2px;
            cursor: pointer;
            color: var(--yt-text-secondary);
            border: none;
            background: transparent;
            position: relative; /* For tooltip positioning */
        }

        .yt-nav-item.active {
            color: var(--yt-text-primary);
        }

        .yt-nav-item .material-icons {
            font-size: 24px;
            color: inherit;
        }

        .yt-nav-label {
            font-size: 10px;
            font-weight: 400;
        }

        /* Badge Counter */
        .nav-badge {
            position: absolute;
            top: 6px;
            right: 6px;
            background: var(--yt-red);
            color: white;
            font-size: 10px;
            font-weight: 500;
            min-width: 16px;
            height: 16px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 4px;
            line-height: 1;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
            padding: 0 16px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--yt-text-primary);
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--yt-divider);
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Roboto', sans-serif;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--yt-blue);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        /* Custom Form Slider for Create Trail */
        .form-slider {
            width: 100%;
            height: 6px;
            -webkit-appearance: none;
            background: #E0E0E0;
            border-radius: 3px;
            outline: none;
            margin: 8px 0;
        }

        .form-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: var(--yt-blue);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            border: 2px solid white;
        }

        .form-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: var(--yt-blue);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            border: 2px solid white;
        }

        /* Parked Video Item */
        .parked-video-item {
            padding: 12px 16px;
            border-bottom: 1px solid var(--yt-divider);
        }

        .parked-header {
            display: flex;
            gap: 12px;
            margin-bottom: 8px;
        }

        .parked-thumbnail {
            width: 120px;
            height: 68px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            flex-shrink: 0;
            position: relative;
        }

        .parked-info {
            flex: 1;
        }

        .parked-title {
            font-size: 13px;
            font-weight: 500;
            line-height: 18px;
            margin-bottom: 4px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .parked-notes {
            padding: 8px 12px;
            background: #F9F9F9;
            border-radius: 8px;
            font-size: 12px;
            color: var(--yt-text-secondary);
            margin-bottom: 8px;
        }

        /* Summary Bar */
        .summary-bar {
            padding: 16px;
            background: var(--yt-blue);
            display: flex;
            justify-content: space-around;
        }

        .summary-item {
            text-align: center;
            color: white;
        }

        .summary-value {
            font-size: 20px;
            font-weight: 500;
            display: block;
        }

        .summary-label {
            font-size: 11px;
            opacity: 0.9;
        }

        /* Tabs */
        .detail-tabs {
            display: flex;
            border-bottom: 1px solid var(--yt-divider);
            background: var(--yt-white);
            position: relative;
            overflow: visible;
            z-index: 150;
        }

        .detail-tab {
            flex: 1;
            padding: 16px;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
            color: var(--yt-text-secondary);
            border-bottom: 2px solid transparent;
            cursor: pointer;
            background: transparent;
            border: none;
            border-bottom: 2px solid transparent;
            position: relative; /* For tooltip positioning */
        }

        .detail-tab.active {
            color: var(--yt-text-primary);
            border-bottom-color: var(--yt-text-primary);
        }

        /* Trail Detail Header */
        .trail-detail-header {
            padding: 16px;
            background: var(--yt-white);
        }

        .trail-detail-title {
            font-size: 20px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .trail-detail-stats {
            display: flex;
            gap: 24px;
            margin: 16px 0;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 18px;
            font-weight: 500;
            display: block;
        }

        .stat-label {
            font-size: 12px;
            color: var(--yt-text-secondary);
        }

        .trail-detail-actions {
            display: flex;
            gap: 8px;
            margin-top: 16px;
        }

        .btn-follow {
            flex: 1;
            padding: 10px;
            background: var(--yt-red);
            color: white;
            border: none;
            border-radius: 18px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
        }

        .btn-follow.following {
            background: #E0E0E0;
            color: var(--yt-text-primary);
        }

        /* Settings List */
        .settings-list {
            padding: 16px 0;
        }

        .settings-item {
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            border-bottom: 1px solid var(--yt-divider);
        }

        .settings-item:hover {
            background: var(--yt-hover);
        }

        .settings-label {
            font-size: 14px;
            font-weight: 400;
        }

        .settings-value {
            font-size: 14px;
            color: var(--yt-text-secondary);
        }

        /* Empty State */
        .empty-state {
            padding: 60px 20px;
            text-align: center;
        }

        .empty-state-icon {
            font-size: 64px;
            color: var(--yt-text-secondary);
            margin-bottom: 16px;
        }

        .empty-state-title {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .empty-state-text {
            font-size: 14px;
            color: var(--yt-text-secondary);
            line-height: 20px;
            margin-bottom: 20px;
        }

        .empty-state-action {
            background: var(--yt-blue);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            transition: opacity 0.2s ease;
        }

        .empty-state-action:hover {
            opacity: 0.9;
        }

        /* Fixed Submit Button */
        .fixed-submit {
            padding: 16px;
            background: var(--yt-white);
            border-top: 1px solid var(--yt-divider);
        }

        .btn-submit {
            width: 100%;
            padding: 12px;
            background: var(--yt-blue);
            color: white;
            border: none;
            border-radius: 18px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
        }

        .btn-submit:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Onboarding Styles */
        .onboarding-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 40px; /* Match phone container */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s ease, visibility 0.4s ease;
            animation: fadeInOverlay 0.4s ease forwards;
        }

        @keyframes fadeInOverlay {
            from {
                opacity: 0;
                visibility: hidden;
            }
            to {
                opacity: 1;
                visibility: visible;
            }
        }

        .onboarding-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            max-width: 360px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 12px 48px rgba(0,0,0,0.3);
            transform: scale(0.9) translateY(20px);
            opacity: 0;
            animation: slideInCard 0.5s ease 0.1s forwards;
        }

        @keyframes slideInCard {
            from {
                transform: scale(0.9) translateY(20px);
                opacity: 0;
            }
            to {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }

        .onboarding-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .onboarding-icon {
            font-size: 64px;
            margin-bottom: 16px;
            display: block;
            color: var(--yt-blue);
        }

        .onboarding-title {
            font-size: 24px;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--yt-text-primary);
        }

        .onboarding-subtitle {
            font-size: 14px;
            color: var(--yt-text-secondary);
        }

        .onboarding-content {
            margin-bottom: 24px;
        }

        .onboarding-feature {
            margin-bottom: 16px;
            padding: 12px;
            background: #F9F9F9;
            border-radius: 8px;
        }

        .feature-label {
            font-size: 12px;
            font-weight: 500;
            color: var(--yt-blue);
            margin-bottom: 4px;
        }

        .feature-text {
            font-size: 13px;
            line-height: 20px;
            color: var(--yt-text-primary);
        }

        .onboarding-actions {
            display: flex;
            gap: 8px;
        }

        .onboarding-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 18px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .onboarding-btn-primary {
            background: var(--yt-blue);
            color: white;
        }

        .onboarding-btn-secondary {
            background: transparent;
            color: var(--yt-blue);
            border: 1px solid var(--yt-divider);
        }

        .onboarding-btn:hover {
            opacity: 0.9;
        }

        .onboarding-close-btn {
            position: absolute;
            top: 16px;
            right: 16px;
            background: none;
            border: none;
            font-size: 24px;
            color: var(--yt-text-secondary);
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s ease;
        }

        .onboarding-close-btn:hover {
            background: var(--yt-hover);
        }

        /* Contextual Onboarding Cards */
        .contextual-onboarding-card {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s ease, visibility 0.4s ease;
            animation: fadeInContextual 0.4s ease forwards;
        }

        @keyframes fadeInContextual {
            from {
                opacity: 0;
                visibility: hidden;
            }
            to {
                opacity: 1;
                visibility: visible;
            }
        }

        .contextual-onboarding-card.show {
            opacity: 1;
            visibility: visible;
        }

        .contextual-card-content {
            background: white;
            border-radius: 16px;
            padding: 24px;
            max-width: 360px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 12px 48px rgba(0,0,0,0.3);
            transform: scale(0.9) translateY(20px);
            opacity: 0;
            transition: transform 0.4s ease, opacity 0.4s ease;
            animation: slideInContextualCard 0.5s ease 0.1s forwards;
        }

        @keyframes slideInContextualCard {
            from {
                transform: scale(0.9) translateY(20px);
                opacity: 0;
            }
            to {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }

        @keyframes fadeOutContextual {
            from {
                opacity: 1;
                visibility: visible;
            }
            to {
                opacity: 0;
                visibility: hidden;
            }
        }

        .contextual-onboarding-card.show .contextual-card-content {
            transform: scale(1);
        }

        .contextual-close-btn {
            position: absolute;
            top: 16px;
            right: 16px;
            background: none;
            border: none;
            font-size: 24px;
            color: var(--yt-text-secondary);
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s ease;
        }

        .contextual-close-btn:hover {
            background: var(--yt-hover);
        }

        .contextual-header {
            text-align: center;
            margin-bottom: 20px;
            padding-right: 40px; /* Space for close button */
        }

        .contextual-icon {
            font-size: 48px;
            margin-bottom: 12px;
            color: var(--yt-blue);
        }

        .contextual-title {
            font-size: 20px;
            font-weight: 500;
            color: var(--yt-text-primary);
            margin-bottom: 4px;
        }

        .contextual-subtitle {
            font-size: 14px;
            color: var(--yt-text-secondary);
        }

        .contextual-body {
            margin-bottom: 20px;
        }

        .contextual-actions {
            display: flex;
            gap: 8px;
        }

        .contextual-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: opacity 0.2s ease;
        }

        .contextual-btn-primary {
            background: var(--yt-blue);
            color: white;
        }

        .contextual-btn:hover {
            opacity: 0.9;
        }

        .onboarding-progress {
            display: flex;
            gap: 4px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .progress-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #E0E0E0;
            transition: background 0.3s;
        }

        .progress-dot.active {
            background: var(--yt-blue);
            width: 24px;
            border-radius: 4px;
        }

        .highlight-target {
            animation: highlight-pulse 2s infinite;
        }

        @keyframes highlight-pulse {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(6, 95, 212, 0.7);
            }
            50% {
                box-shadow: 0 0 0 10px rgba(6, 95, 212, 0);
            }
        }

        /* Hover Tooltip System - Two Types */
        
        /* Type 1: Small Label Tooltips (for simple labels like nav, tabs) */
        .has-tooltip-small {
            position: relative;
            cursor: help;
        }

        .tooltip-small {
            position: fixed !important; /* Use fixed for viewport-relative positioning */
            background: var(--yt-text-primary);
            color: white;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 11px;
            line-height: 16px;
            white-space: nowrap;
            z-index: 280 !important; /* Lower than slider (300) but higher than chips (250) */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            pointer-events: none;
            display: none;
        }

        .tooltip-small::after {
            content: '';
            position: absolute;
            top: 100%;
            left: var(--arrow-left, 50%);
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: var(--yt-text-primary);
        }

        /* Type 2: Large Feature Tooltips (centered with overlay) */
        .has-tooltip-feature {
            position: relative;
            cursor: help;
        }

        .has-tooltip-feature:hover .tooltip-feature-overlay {
            display: flex;
        }

        .tooltip-feature-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 9997;
            display: none;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.2s ease;
            border-radius: 40px; /* Match phone container */
        }

        .tooltip-feature-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            max-width: 340px;
            width: 90%;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            animation: scaleIn 0.3s ease;
        }

        .tooltip-feature-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--yt-text-primary);
        }

        .tooltip-feature-text {
            font-size: 13px;
            line-height: 20px;
            color: var(--yt-text-secondary);
        }

        /* Feature Help Modal - Centered with Overlay */
        .feature-help-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 9998;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.2s ease;
            border-radius: 40px; /* Match phone container */
        }

        /* Toast Notification System */
        .toast-container {
            position: fixed;
            top: 100px; /* Below header, above content */
            left: 50%;
            transform: translateX(-50%);
            z-index: 10000;
            pointer-events: none;
        }

        .toast {
            background: #323232; /* Material Design Dark Surface */
            color: white;
            padding: 12px 20px;
            border-radius: 4px; /* Material Design standard radius */
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
            box-shadow: 0 3px 5px -1px rgba(0,0,0,0.2), 0 6px 10px 0 rgba(0,0,0,0.14), 0 1px 18px 0 rgba(0,0,0,0.12);
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s ease;
            max-width: 320px;
            text-align: center;
            white-space: nowrap;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast.success {
            background: #4CAF50; /* Material Design Green 500 */
        }

        .toast.info {
            background: #2196F3; /* Material Design Blue 500 */
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .feature-help-modal {
            background: white;
            border-radius: 16px;
            padding: 20px;
            max-width: 360px;
            width: 90%;
            box-shadow: 0 12px 48px rgba(0,0,0,0.3);
            z-index: 9999;
            animation: scaleIn 0.3s ease;
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .feature-help-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .feature-help-title {
            font-size: 14px;
            font-weight: 500;
            color: var(--yt-text-primary);
        }

        .feature-help-text {
            font-size: 13px;
            line-height: 20px;
            color: var(--yt-text-secondary);
        }
    </style>
</head>
<body>
    <div class="phone-container">
        <div class="app" id="app"></div>
    </div>

    <script>
        // Mock Data
        const mockTrails = [
            {
                id: '1',
                name: 'Web Development Mastery',
                creator: 'TechExplorer',
                description: 'A comprehensive trail covering modern web development from basics to advanced',
                followerCount: 2847,
                videoCount: 18,
                estimatedTime: '4h 32m',
                tags: ['JavaScript', 'React', 'Node.js'],
                focusRatio: 75,
                skillLevel: 'Intermediate',
                following: false,
                created: true,
                notes: `📝 Trail Overview:\nThis trail takes you through modern web development, from fundamentals to advanced frameworks.\n\n🎯 Learning Path:\n1. Start with HTML/CSS basics to build solid foundations\n2. Master JavaScript ES6+ features\n3. Dive into React for building dynamic UIs\n4. Learn Node.js for backend development\n\n💡 Pro Tips:\n• Build projects after each section\n• Focus on understanding concepts\n• Join the community for support`,
                color: '#667eea',
                pathData: [
                    { video: 'HTML & CSS Fundamentals', duration: '45:00', completed: true, date: '2025-09-15' },
                    { video: 'JavaScript Basics to Advanced', duration: '3:20:00', completed: true, date: '2025-09-20' },
                    { video: 'React Complete Guide', duration: '8:45:00', completed: true, date: '2025-10-01' },
                    { video: 'Next.js 14 Tutorial', duration: '16:45', completed: false, date: null },
                    { video: 'Node.js & Express', duration: '2:15:00', completed: false, date: null },
                ],
            },
            {
                id: '2',
                name: 'Quantum Physics Explained',
                creator: 'ScienceDaily',
                description: 'Understanding quantum mechanics through visual explanations',
                followerCount: 1247,
                videoCount: 12,
                estimatedTime: '2h 15m',
                tags: ['Physics', 'Quantum', 'Science'],
                focusRatio: 90,
                skillLevel: 'Advanced',
                following: true,
                created: false,
                notes: `📝 Trail Overview:\nJourney through quantum physics, from classical foundations to cutting-edge applications.\n\n🎯 Prerequisites:\n• Basic classical physics understanding\n• Comfort with mathematical notation\n\n🔬 What You'll Learn:\n- Wave-particle duality\n- Quantum entanglement\n- Superposition principles\n- Real-world applications`,
                color: '#2BA640',
                pathData: [
                    { video: 'Classical Physics Review', duration: '25:30', completed: true, date: '2025-08-25' },
                    { video: 'Introduction to Quantum Mechanics', duration: '42:15', completed: true, date: '2025-09-01' },
                    { video: 'Wave-Particle Duality', duration: '18:20', completed: false, date: null },
                    { video: 'Quantum Entanglement', duration: '15:32', completed: false, date: null },
                ],
            },
            {
                id: '3',
                name: 'Mediterranean Cooking',
                creator: 'ChefMaria',
                description: 'Authentic Mediterranean recipes from Greece, Italy, and Spain',
                followerCount: 1567,
                videoCount: 8,
                estimatedTime: '1h 45m',
                tags: ['Cooking', 'Mediterranean', 'Recipes'],
                focusRatio: 65,
                skillLevel: 'Beginner',
                following: false,
                created: true,
                notes: `📝 Trail Overview:\nExplore the rich culinary traditions of the Mediterranean region.\n\n🍳 What You'll Master:\n• Italian pasta-making techniques\n• Greek salad and mezze\n• Spanish paella and tapas\n• Healthy Mediterranean diet\n\n🛒 Equipment Needed:\n- Basic kitchen tools\n- Good quality olive oil\n- Fresh ingredients`,
                color: '#FF6B6B',
                pathData: [
                    { video: 'Mediterranean Diet Basics', duration: '12:08', completed: true, date: '2025-09-10' },
                    { video: 'Perfect Greek Salad', duration: '8:30', completed: true, date: '2025-09-15' },
                    { video: 'Fresh Pasta from Scratch', duration: '15:20', completed: true, date: '2025-09-22' },
                    { video: 'Spanish Paella Recipe', duration: '16:45', completed: false, date: null },
                    { video: 'Turkish Baklava', duration: '19:30', completed: false, date: null },
                ],
            },
            {
                id: '4',
                name: 'Machine Learning Fundamentals',
                creator: 'DataSciencePro',
                description: 'Learn the basics of machine learning from scratch',
                followerCount: 3421,
                videoCount: 15,
                estimatedTime: '3h 20m',
                tags: ['AI', 'Python', 'Data Science'],
                focusRatio: 85,
                skillLevel: 'Intermediate',
                following: true,
                created: false,
                notes: `📝 Trail Overview:\nA comprehensive introduction to machine learning concepts and practical applications.\n\n🎯 What You'll Learn:\n• Supervised and unsupervised learning\n• Neural networks basics\n• Data preprocessing\n• Model evaluation\n\n💡 Prerequisites:\n• Basic Python knowledge\n• Understanding of statistics`,
                color: '#9C27B0',
                pathData: [
                    { video: 'Introduction to ML', duration: '32:15', completed: true, date: '2025-09-05' },
                    { video: 'Linear Regression', duration: '28:45', completed: true, date: '2025-09-12' },
                    { video: 'Classification Algorithms', duration: '35:20', completed: false, date: null },
                    { video: 'Neural Networks Basics', duration: '42:10', completed: false, date: null },
                ],
            },
            {
                id: '5',
                name: 'Digital Photography Mastery',
                creator: 'PhotoPro',
                description: 'Master the art of digital photography from basics to professional techniques',
                followerCount: 1892,
                videoCount: 22,
                estimatedTime: '5h 15m',
                tags: ['Photography', 'Camera', 'Editing'],
                focusRatio: 70,
                skillLevel: 'Beginner',
                following: true,
                created: false,
                notes: `📝 Trail Overview:\nLearn digital photography from the ground up, covering camera basics, composition, lighting, and post-processing.\n\n🎯 What You'll Master:\n• Camera settings and manual mode\n• Composition techniques\n• Lighting fundamentals\n• Photo editing basics\n\n📸 Equipment Needed:\n- Any digital camera (DSLR, mirrorless, or smartphone)\n- Basic photo editing software`,
                color: '#FF9800',
                pathData: [
                    { video: 'Camera Basics', duration: '28:30', completed: true, date: '2025-09-08' },
                    { video: 'Understanding Exposure', duration: '35:20', completed: true, date: '2025-09-15' },
                    { video: 'Composition Rules', duration: '42:15', completed: false, date: null },
                    { video: 'Lighting Techniques', duration: '38:45', completed: false, date: null },
                ],
            },
        ];

        // Trail-specific videos
        const trailVideos = {
            'Web Development Mastery': [
                {
                    id: 'web1',
                    title: 'Next.js 14 - What\'s New? Complete Tutorial',
                    channel: 'Vercel',
                    duration: '16:45',
                    tags: ['Next.js', 'React', 'Web Dev'],
                    views: '245K views',
                    time: '2 days ago',
                    trailRelevance: 'Web Development Mastery',
                },
                {
                    id: 'web2',
                    title: 'Advanced React Hooks - useCallback vs useMemo',
                    channel: 'Web Dev Simplified',
                    duration: '12:20',
                    tags: ['React', 'Hooks', 'JavaScript'],
                    views: '156K views',
                    time: '1 week ago',
                    trailRelevance: 'Web Development Mastery',
                },
                {
                    id: 'web3',
                    title: 'Building REST APIs with Node.js and Express',
                    channel: 'Traversy Media',
                    duration: '28:15',
                    tags: ['Node.js', 'Express', 'API'],
                    views: '892K views',
                    time: '3 days ago',
                    trailRelevance: 'Web Development Mastery',
                },
                {
                    id: 'web4',
                    title: 'CSS Grid Layout: Complete Guide',
                    channel: 'Kevin Powell',
                    duration: '22:40',
                    tags: ['CSS', 'Grid', 'Layout'],
                    views: '421K views',
                    time: '5 days ago',
                    trailRelevance: 'Web Development Mastery',
                },
                {
                    id: 'web5',
                    title: 'TypeScript for JavaScript Developers',
                    channel: 'Academind',
                    duration: '18:55',
                    tags: ['TypeScript', 'JavaScript'],
                    views: '678K views',
                    time: '1 day ago',
                    trailRelevance: 'Web Development Mastery',
                },
            ],
            'Quantum Physics Explained': [
                {
                    id: 'sci1',
                    title: 'Quantum Entanglement Explained Simply',
                    channel: 'PBS Space Time',
                    duration: '15:32',
                    tags: ['Quantum', 'Physics', 'Science'],
                    views: '1.2M views',
                    time: '2 weeks ago',
                    trailRelevance: 'Quantum Physics Explained',
                },
                {
                    id: 'sci2',
                    title: 'Schrödinger\'s Cat - The Paradox Explained',
                    channel: 'Veritasium',
                    duration: '14:18',
                    tags: ['Quantum', 'Paradox', 'Science'],
                    views: '2.4M views',
                    time: '3 days ago',
                    trailRelevance: 'Quantum Physics Explained',
                },
                {
                    id: 'sci3',
                    title: 'Double Slit Experiment: Wave-Particle Duality',
                    channel: 'Physics Explained',
                    duration: '12:45',
                    tags: ['Quantum', 'Experiment', 'Physics'],
                    views: '890K views',
                    time: '1 week ago',
                    trailRelevance: 'Quantum Physics Explained',
                },
                {
                    id: 'sci4',
                    title: 'Quantum Computing: The Future of Technology',
                    channel: 'Tech Vision',
                    duration: '20:10',
                    tags: ['Quantum', 'Computing', 'Tech'],
                    views: '567K views',
                    time: '4 days ago',
                    trailRelevance: 'Quantum Physics Explained',
                },
                {
                    id: 'sci5',
                    title: 'Heisenberg Uncertainty Principle Made Easy',
                    channel: 'Science Asylum',
                    duration: '11:25',
                    tags: ['Quantum', 'Physics', 'Theory'],
                    views: '345K views',
                    time: '2 days ago',
                    trailRelevance: 'Quantum Physics Explained',
                },
            ],
            'Mediterranean Cooking': [
                {
                    id: 'cook1',
                    title: 'Greek Salad Recipe - Authentic Mediterranean',
                    channel: 'Mediterranean Kitchen',
                    duration: '8:30',
                    tags: ['Greek', 'Salad', 'Healthy'],
                    views: '89K views',
                    time: '1 day ago',
                    trailRelevance: 'Mediterranean Cooking',
                },
                {
                    id: 'cook2',
                    title: 'Perfect Italian Pasta Carbonara - Traditional Recipe',
                    channel: 'Pasta Grannies',
                    duration: '13:20',
                    tags: ['Italian', 'Pasta', 'Traditional'],
                    views: '456K views',
                    time: '3 days ago',
                    trailRelevance: 'Mediterranean Cooking',
                },
                {
                    id: 'cook3',
                    title: 'Spanish Paella - Authentic Valencian Recipe',
                    channel: 'Spain on a Fork',
                    duration: '16:45',
                    tags: ['Spanish', 'Paella', 'Seafood'],
                    views: '234K views',
                    time: '5 days ago',
                    trailRelevance: 'Mediterranean Cooking',
                },
                {
                    id: 'cook4',
                    title: 'Homemade Hummus - Lebanese Style',
                    channel: 'Middle Eastern Kitchen',
                    duration: '7:15',
                    tags: ['Lebanese', 'Hummus', 'Vegan'],
                    views: '178K views',
                    time: '2 days ago',
                    trailRelevance: 'Mediterranean Cooking',
                },
                {
                    id: 'cook5',
                    title: 'Turkish Baklava: Sweet Layered Pastry',
                    channel: 'Turkish Delights',
                    duration: '19:30',
                    tags: ['Turkish', 'Dessert', 'Baklava'],
                    views: '312K views',
                    time: '1 week ago',
                    trailRelevance: 'Mediterranean Cooking',
                },
            ],
        };

        // Regular feed - mixed content with soft pastel colors (color psychology)
        const regularFeedVideos = [
            {
                id: 'reg1',
                title: 'Morning Yoga Flow - 15 Minute Routine',
                channel: 'Yoga With Adriene',
                duration: '15:20',
                tags: ['Yoga', 'Fitness', 'Wellness'],
                views: '2.1M views',
                time: '1 week ago',
                color: '#B39DDB', // Soft Lavender - calming, spiritual, wellness
            },
            {
                id: 'reg2',
                title: 'iPhone 15 Pro Review - Worth the Upgrade?',
                channel: 'Marques Brownlee',
                duration: '14:32',
                tags: ['Tech', 'iPhone', 'Review'],
                views: '5.6M views',
                time: '2 days ago',
                color: '#FFAB91', // Soft Peach - innovative, warm, approachable tech
            },
            {
                id: 'reg3',
                title: 'How to Train Your Dog - Basic Commands',
                channel: 'Zak George\'s Dog Training',
                duration: '18:45',
                tags: ['Dogs', 'Training', 'Pets'],
                views: '892K views',
                time: '4 days ago',
                color: '#A1887F', // Soft Brown - earthy, trustworthy, natural (pets)
            },
            {
                id: 'reg4',
                title: '10 Minute Ab Workout - No Equipment Needed',
                channel: 'FitnessBlender',
                duration: '10:15',
                tags: ['Fitness', 'Workout', 'Abs'],
                views: '1.3M views',
                time: '3 days ago',
                color: '#F48FB1', // Soft Pink - energetic, active, motivating
            },
            {
                id: 'reg5',
                title: 'Learning Guitar - Beginner Chords',
                channel: 'JustinGuitar',
                duration: '12:20',
                tags: ['Guitar', 'Music', 'Tutorial'],
                views: '678K views',
                time: '1 week ago',
                color: '#FFD54F', // Soft Gold - creative, harmonious, cheerful (music)
            },
            {
                id: 'reg6',
                title: 'Traveling Japan on a Budget - Complete Guide',
                channel: 'Lost LeBlanc',
                duration: '22:10',
                tags: ['Travel', 'Japan', 'Budget'],
                views: '1.8M views',
                time: '5 days ago',
                color: '#80DEEA', // Soft Cyan - peaceful, exploratory, adventure
            },
            {
                id: 'reg7',
                title: 'Photography Tips for Beginners',
                channel: 'Peter McKinnon',
                duration: '16:35',
                tags: ['Photography', 'Tutorial', 'Camera'],
                views: '945K views',
                time: '2 days ago',
                color: '#90CAF9', // Soft Blue - artistic, calm, creative focus
            },
        ];

        const mockParkedVideos = [
            {
                id: 'p1',
                title: 'Advanced React Patterns You Should Know',
                channel: 'CodeMaster',
                duration: '24:35',
                tags: ['React', 'JavaScript'],
                watched: false,
                notes: 'Learn about compound components and render props',
                parkedDate: '2025-10-08',
            },
            {
                id: 'p2',
                title: 'Understanding Quantum Entanglement',
                channel: 'Physics Explained',
                duration: '18:42',
                tags: ['Physics', 'Quantum'],
                watched: false,
                notes: 'EPR paradox and Bell\'s theorem',
                parkedDate: '2025-10-07',
            },
            {
                id: 'p3',
                title: 'Perfect Homemade Pasta from Scratch',
                channel: 'Italian Kitchen',
                duration: '15:20',
                tags: ['Cooking', 'Italian'],
                watched: true,
                notes: 'Great technique for fresh pasta',
                parkedDate: '2025-10-05',
            },
        ];

        // Topic map data - Main topics + Meta tags
        const topicMaps = {
            'Web Development Mastery': {
                leftMain: 'React',
                rightMain: 'Node.js',
                left: {
                    mainTopics: ['React', 'Vue', 'Angular', 'Svelte', 'HTML/CSS'],
                    metaTags: ['TypeScript', 'JavaScript', 'UI/UX', 'Responsive', 'Animations', 'State Management', 'Hooks', 'Components']
                },
                right: {
                    mainTopics: ['Node.js', 'Python', 'Django', 'FastAPI', 'PHP'],
                    metaTags: ['REST API', 'GraphQL', 'Databases', 'MongoDB', 'PostgreSQL', 'Authentication', 'DevOps', 'Docker']
                },
                connections: ['Frontend ↔ Backend', 'UI ↔ API', 'Client ↔ Server']
            },
            'Quantum Physics Explained': {
                leftMain: 'Classical Physics',
                rightMain: 'Quantum Computing',
                left: {
                    mainTopics: ['Classical Physics', 'Thermodynamics', 'Mechanics', 'Wave Theory', 'Relativity'],
                    metaTags: ['Mathematics', 'Equations', 'Laws', 'Principles', 'Concepts', 'History', 'Scientists', 'Papers']
                },
                right: {
                    mainTopics: ['Quantum Computing', 'Experiments', 'Technology', 'Engineering', 'Lab Work'],
                    metaTags: ['Superposition', 'Entanglement', 'Qubits', 'Algorithms', 'Particles', 'Measurements', 'Applications', 'Future']
                },
                connections: ['Classical ↔ Quantum', 'Wave ↔ Particle', 'Theory ↔ Application']
            },
            'Mediterranean Cooking': {
                leftMain: 'Italian',
                rightMain: 'Greek',
                left: {
                    mainTopics: ['Italian', 'Pasta', 'Pizza', 'Risotto', 'Sicilian'],
                    metaTags: ['Tomato Sauce', 'Cheese', 'Herbs', 'Olive Oil', 'Wine Pairing', 'Baking', 'Desserts', 'Regional']
                },
                right: {
                    mainTopics: ['Greek', 'Turkish', 'Spanish', 'Lebanese', 'Moroccan'],
                    metaTags: ['Mezze', 'Seafood', 'Grilling', 'Spices', 'Vegetables', 'Yogurt', 'Healthy', 'Traditional']
                },
                connections: ['Italian ↔ Mediterranean', 'Traditional ↔ Modern', 'Savory ↔ Sweet']
            },
        };

        // App State
        let state = {
            currentScreen: 'home',
            selectedChip: 'all',
            isTrailFeed: false,
            activeTrail: 'Web Development Mastery', // Default trail
            focusRatio: 70,
            focusSliderExpanded: false,
            showTopicMapLeft: false,
            showTopicMapRight: false,
            // Single main topic per side
            selectedMainTopicLeft: 'React',
            selectedMainTopicRight: 'Node.js',
            // Multiple meta tags per side
            selectedMetaTagsLeft: [],
            selectedMetaTagsRight: [],
            // Search
            searchQueryLeft: '',
            searchQueryRight: '',
            showSuggestion: true,
            currentBottomTab: 'home',
            selectedTrail: null,
            trailDetailTab: 'videos',
            parkedTab: 'towatch',
            myTrailsTab: 'following',
            createTrailData: {
                name: '',
                description: '',
                topic: '',
                region: 'Global',
                skillLevel: 'Beginner',
                focusRatio: 70,
            },
            notifications: true,
            focusDefault: 70,
            // Onboarding
            showOnboarding: true, // Show on first open
            onboardingStep: 0,
            // Feature Help
            showFeatureHelp: null, // stores which feature help to show
            
            // Contextual Onboarding - Track first-time feature usage
            contextualOnboarding: {
                feedToggle: false,        // Step 1: Feed Toggle
                contentSlider: false,     // Step 2: Content Focus Slider  
                trailDetails: false,      // Step 3: Trail Details
                trailSuggestions: false,  // Step 4: Smart Trail Suggestions
                parkedVideos: false,      // Step 5: Parked Videos
                trailPath: false,         // Step 6: Trail Path
                followTrails: false,      // Step 7: Follow Trails & Community
                notes: false,             // Step 8: Notes & Summaries
                createTrail: false        // Step 9: Create Trail
            }
        };

        console.log('YouTube Trails v3.1 - Documentation-Based Help!');

        // Feature to Onboarding Step Mapping
        const featureToOnboardingStep = {
            'feedToggle': 1,        // Feed Toggle
            'contentSlider': 2,     // Content Focus Slider
            'trailDetails': 3,      // Trail Details
            'trailSuggestions': 4,  // Smart Trail Suggestions
            'parkedVideos': 5,      // Parked Videos
            'trailPath': 6,         // Trail Path
            'followTrails': 7,      // Follow Trails & Community
            'notes': 8,             // Notes & Summaries
            'createTrail': 9        // Create Trail
        };

        // Full Feature Documentation (Original 10 cards - for scrollable help screen)
        const featureDocumentation = [
            {
                icon: 'route',
                title: 'Welcome to YouTube Trails!',
                subtitle: 'Organize your viewing into focused learning journeys',
                content: `
                    <div class="feature-text" style="text-align: center; margin-bottom: 16px;">
                        YouTube Trails helps you transform passive watching into structured learning experiences.
                    </div>
                    <div class="onboarding-feature">
                        <div class="feature-label">FOCUSED LEARNING</div>
                        <div class="feature-text">Create topic-specific content streams</div>
                    </div>
                    <div class="onboarding-feature">
                        <div class="feature-label">ORGANIZED DISCOVERY</div>
                        <div class="feature-text">Track your progress through topics</div>
                    </div>
                    <div class="onboarding-feature">
                        <div class="feature-label">COMMUNITY CURATION</div>
                        <div class="feature-text">Follow trails created by others</div>
                    </div>
                `
            },
            {
                icon: 'swap_horiz',
                title: 'Feed Toggle',
                subtitle: 'Switch between Regular & Trail Feed',
                content: `
                    <div class="feature-text" style="margin-bottom: 16px;">
                        Control your viewing focus with a simple toggle.
                    </div>
                    <div class="onboarding-feature">
                        <div class="feature-label">REGULAR FEED</div>
                        <div class="feature-text">Your familiar YouTube feed with mixed topics based on your overall behavior.</div>
                    </div>
                    <div class="onboarding-feature">
                        <div class="feature-label">TRAIL FEED</div>
                        <div class="feature-text">Focused, topic-specific content that helps you stay on track with structured learning.</div>
                    </div>
                    <div style="padding: 12px; background: #E8F0FE; border-radius: 8px; margin-top: 12px; font-size: 12px; line-height: 18px;">
                        💡 <strong>Tip:</strong> Use Regular Feed for casual browsing, Trail Feed for intentional learning sessions.
                    </div>
                `
            },
            {
                icon: 'tune',
                title: 'Content Focus Slider',
                subtitle: 'Fine-tune your content mix',
                content: `
                    <div class="feature-text" style="margin-bottom: 16px;">
                        Adjust how narrow or broad your Trail recommendations are.
                    </div>
                    <div class="onboarding-feature">
                        <div class="feature-label">EXAMPLE: React 70% ↔ 30% Node.js</div>
                        <div class="feature-text">See mostly React content with some Node.js mixed in for full-stack perspective.</div>
                    </div>
                    <div class="onboarding-feature">
                        <div class="feature-label">WHY IT'S POWERFUL</div>
                        <div class="feature-text">• Prevents fatigue from too much of one thing<br>• Balances depth with discovery<br>• You control the algorithm blend</div>
                    </div>
                    <div style="padding: 12px; background: #FFF9E6; border-radius: 8px; margin-top: 12px; font-size: 12px;">
                        ⚡ Tap the slider anytime to adjust your content balance
                    </div>
                `
            },
            {
                icon: 'map',
                title: 'Trail Details',
                subtitle: 'Your topic-based learning hub',
                content: `
                    <div class="feature-text" style="margin-bottom: 16px;">
                        Each Trail is a dynamic, social learning space.
                    </div>
                    <div class="onboarding-feature">
                        <div class="feature-label">NOT JUST A PLAYLIST</div>
                        <div class="feature-text">Trails update automatically with new content and are shared across the community.</div>
                    </div>
                    <div class="onboarding-feature">
                        <div class="feature-label">INCLUDES</div>
                        <div class="feature-text">• Curated videos<br>• Related tags<br>• Learning notes<br>• Progress tracking<br>• Follower community</div>
                    </div>
                `
            },
            {
                icon: 'lightbulb',
                title: 'Smart Trail Suggestions',
                subtitle: 'Turn patterns into trails',
                content: `
                    <div class="feature-text" style="margin-bottom: 16px;">
                        We notice when you're interested in a topic and suggest organizing it.
                    </div>
                    <div class="onboarding-feature">
                        <div class="feature-label">CONTEXTUAL PROMPTS</div>
                        <div class="feature-text">"You've watched 7+ videos on Yoga — want to create a Trail?"</div>
                    </div>
                    <div class="onboarding-feature">
                        <div class="feature-label">WHY IT HELPS</div>
                        <div class="feature-text">• Converts passive consumption into active organization<br>• Light-touch, non-intrusive<br>• Makes you feel guided, not overwhelmed</div>
                    </div>
                `
            },
            {
                icon: 'bookmark',
                title: 'Parked Videos',
                subtitle: 'Intentional "Watch Later"',
                content: `
                    <div class="feature-text" style="margin-bottom: 16px;">
                        A smarter, context-aware version of Watch Later.
                    </div>
                    <div class="onboarding-feature">
                        <div class="feature-label">THE PROBLEM WITH WATCH LATER</div>
                        <div class="feature-text">It becomes a cluttered, undifferentiated list that you never actually watch.</div>
                    </div>
                    <div class="onboarding-feature">
                        <div class="feature-label">PARKED VIDEOS SOLUTION</div>
                        <div class="feature-text">• Assign videos to specific Trails<br>• Add notes and keywords<br>• Separate "To Watch" vs "Watched"<br>• Track total time pending</div>
                    </div>
                `
            },
            {
                icon: 'timeline',
                title: 'Trail Path',
                subtitle: 'Your learning journey visualized',
                content: `
                    <div class="feature-text" style="margin-bottom: 16px;">
                        See your progress through a topic as a navigable timeline.
                    </div>
                    <div class="onboarding-feature">
                        <div class="feature-label">BETTER THAN HISTORY</div>
                        <div class="feature-text">YouTube history is a flat list. Trail Path is organized by topic with keywords and tags.</div>
                    </div>
                    <div class="onboarding-feature">
                        <div class="feature-label">SUPPORTS LEARNING</div>
                        <div class="feature-text">• See what you've completed<br>• Track progress visually<br>• Revisit key concepts<br>• Feel accomplishment</div>
                    </div>
                `
            },
            {
                icon: 'group',
                title: 'Follow Trails & Community',
                subtitle: 'Topic-centric, not just creator-centric',
                content: `
                    <div class="feature-text" style="margin-bottom: 16px;">
                        Connect over shared interests, not just personalities.
                    </div>
                    <div class="onboarding-feature">
                        <div class="feature-label">NEW DISCOVERY LAYER</div>
                        <div class="feature-text">Follow Trails curated by experts, educators, or fellow learners in your field.</div>
                    </div>
                    <div class="onboarding-feature">
                        <div class="feature-label">EXPANDS YOUTUBE</div>
                        <div class="feature-text">• Creates curator role<br>• Builds topic communities<br>• Enables collaborative learning<br>• Shares knowledge paths</div>
                    </div>
                `
            },
            {
                icon: 'note',
                title: 'Notes & Summaries',
                subtitle: 'Make YouTube interactive',
                content: `
                    <div class="feature-text" style="margin-bottom: 16px;">
                        Add your own annotations and insights to trails and videos.
                    </div>
                    <div class="onboarding-feature">
                        <div class="feature-label">PERSONAL LEARNING TOOL</div>
                        <div class="feature-text">Jot down key takeaways, reminders, or questions as you learn.</div>
                    </div>
                    <div class="onboarding-feature">
                        <div class="feature-label">PERFECT FOR</div>
                        <div class="feature-text">• Students taking courses<br>• Professionals upskilling<br>• Educators organizing content<br>• Anyone learning systematically</div>
                    </div>
                    <div style="padding: 12px; background: #E8F0FE; border-radius: 8px; margin-top: 12px; font-size: 12px;">
                        🚀 Potential integrations: Google Keep, Notion, Evernote
                    </div>
                `
            },
            {
                icon: 'check_circle',
                title: 'You\'re All Set!',
                subtitle: 'Start exploring',
                content: `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 16px; font-weight: 500; margin-bottom: 12px; line-height: 24px;">
                            Transform how you use YouTube:<br>from endless scrolling to purposeful learning.
                        </div>
                    </div>
                    <div class="onboarding-feature" style="background: #E8F0FE; border: 2px solid var(--yt-blue);">
                        <div class="feature-label">QUICK START GUIDE</div>
                        <div class="feature-text">
                            1. Toggle to <strong>Trail Feed</strong><br>
                            2. Select a trail (Web Dev, Science, or Cooking)<br>
                            3. Adjust the <strong>content slider</strong><br>
                            4. Park videos you want to watch later<br>
                            5. Track your progress in <strong>Trail Path</strong>
                        </div>
                    </div>
                    <div class="onboarding-feature" style="background: #FFF9E6; border-left: 4px solid #FFD54F; margin-top: 12px;">
                        <div class="feature-label">📖 NEED A REFRESHER?</div>
                        <div class="feature-text">Access all 10 features as a <strong>scrollable guide</strong> anytime:<br><strong>Profile → Complete Guide</strong></div>
                    </div>
                    <div style="padding: 10px; background: #F9F9F9; border-radius: 8px; margin-top: 12px; font-size: 11px; text-align: center; color: var(--yt-text-secondary);">
                        💡 Prefer to read everything at once?<br>
                        <span style="color: var(--yt-blue); cursor: pointer; font-weight: 500;" onclick="skipOnboarding(); changeScreen('featureguide'); render();">
                            Skip to Scrollable Guide
                        </span>
                    </div>
                `
            },
        ];

        // Feature Help Content (contextual tooltips)
        const featureHelp = {
            'feed-toggle': {
                title: '🌐 Feed Toggle',
                text: 'Switch between <strong>Regular Feed</strong> (mixed topics) and <strong>Trail Feed</strong> (focused topics). Use Regular for casual browsing, Trail for intentional learning.'
            },
            'content-slider': {
                title: '🎚️ Content Slider',
                text: 'Adjust your topic balance (e.g., 70% React ↔ 30% Node.js). Slide left for more focus, right for more variety. Prevents content fatigue!'
            },
            'park-video': {
                title: '📑 Park Videos',
                text: 'Save videos with context! Unlike Watch Later, you can assign them to specific Trails and add notes. Find them in the Parked tab.'
            },
            'trail-path': {
                title: '🧭 Trail Path',
                text: 'See your learning journey as a visual timeline. Track completed videos, progress percentage, and revisit key concepts anytime.'
            },
            'trail-details': {
                title: '🗺️ Trail Details',
                text: 'Each Trail has Videos, Tags, Notes, and Path tabs. Follow trails made by others or create your own. It\'s like a playlist, but smarter!'
            },
        };

        // Render Main App
        function renderApp() {
            const screens = {
                'home': renderHomeScreen,
                'mytrails': renderMyTrailsScreen,
                'traildetail': renderTrailDetailScreen,
                'parked': renderParkedScreen,
                'createtrail': renderCreateTrailScreen,
                'profile': renderProfileScreen,
                'featureguide': renderFeatureGuideScreen,
            };

            return screens[state.currentScreen]();
        }

        // Home Screen
        function renderHomeScreen() {
            return `
                ${renderHeader()}
                ${renderTrailToggleBar()}
                ${renderChipsBar()}
                ${renderContent()}
                ${renderBottomNav()}
                ${state.showFeatureHelp ? renderFeatureHelpModal() : ''}
                ${state.showOnboarding ? renderOnboarding() : ''}
                
                <!-- Toast Container -->
                <div class="toast-container" id="toastContainer"></div>
            `;
        }

        function renderHeader() {
            return `
                <div class="yt-header">
                    <div class="yt-logo">
                        <div class="yt-logo-icon ${state.isTrailFeed ? 'trail-mode' : ''}">
                            ${state.isTrailFeed 
                                ? '<span class="material-icons" style="font-size: 20px; color: white;">route</span>' 
                                : '▶'}
                        </div>
                        <span class="yt-logo-text">YouTube</span>
                        <span class="yt-logo-trails">Trails</span>
                    </div>
                    <div class="yt-header-actions">
                        <button class="yt-icon-btn">
                            <span class="material-icons">cast</span>
                        </button>
                        <button class="yt-icon-btn" onclick="changeScreen('notifications')">
                            <span class="material-icons">notifications_none</span>
                        </button>
                        <button class="yt-icon-btn">
                            <span class="material-icons">search</span>
                        </button>
                    </div>
                </div>
            `;
        }

        function renderTrailToggleBar() {
            return `
                <div class="trail-toggle-bar">
                    <div class="toggle-group has-tooltip-small">
                        <span class="toggle-label ${!state.isTrailFeed ? 'active' : ''}">Regular</span>
                        <div class="yt-toggle ${state.isTrailFeed ? 'active' : ''}" onclick="toggleFeed()">
                            <div class="yt-toggle-thumb"></div>
                        </div>
                        <span class="toggle-label ${state.isTrailFeed ? 'active' : ''}">Trail Feed</span>
                        <div class="tooltip-small">🌐 Switch feed mode</div>
                    </div>
                    ${state.isTrailFeed ? renderInlineSlider() : ''}
                </div>
            `;
        }

        function renderInlineSlider() {
            const trail = mockTrails.find(t => t.name === state.activeTrail);
            const trailColor = trail ? trail.color : '#667eea';
            
            const leftPercent = state.focusRatio;
            const rightPercent = 100 - state.focusRatio;
            
            // Use selected main topics or defaults
            const leftTopic = state.selectedMainTopicLeft;
            const rightTopic = state.selectedMainTopicRight;
            
            if (!state.focusSliderExpanded) {
                // Collapsed state - show selected topics with percentages
                return `
                    <div class="focus-slider-section inline-mode has-tooltip-small" onclick="toggleSlider()">
                        <div class="focus-slider-collapsed">
                            <span class="collapsed-label" style="font-size: 11px;">${leftTopic} ${leftPercent}%</span>
                            <span class="collapsed-value" style="font-size: 11px; color: var(--yt-text-secondary);">↔</span>
                            <span class="collapsed-label" style="font-size: 11px;">${rightPercent}% ${rightTopic}</span>
                        </div>
                        <div class="tooltip-small">🎚️ Tap to adjust mix</div>
                    </div>
                `;
            }

            // Expanded state - drops down below toggle bar
            const leftMetaCount = state.selectedMetaTagsLeft.length;
            const rightMetaCount = state.selectedMetaTagsRight.length;
            
            return `
                <div class="focus-slider-section expanded-mode">
                    <div class="focus-slider-expanded">
                        <button class="slider-close-btn" onclick="event.stopPropagation(); toggleSlider()" title="Close">
                            <span class="material-icons" style="font-size: 18px;">close</span>
                        </button>
                        <div class="focus-slider-header">
                            <span class="focus-slider-label">Content Balance</span>
                        </div>
                        
                        <div class="topic-bubbles">
                            <div style="display: flex; flex-direction: column; align-items: center; gap: 4px;">
                                <div class="topic-bubble ${state.showTopicMapLeft ? 'active' : ''}" 
                                     style="background: ${trailColor};"
                                     onclick="event.stopPropagation(); showTopicMap('left')">
                                    ${leftMetaCount > 0 ? leftMetaCount : '◐'}
                                </div>
                                <span style="font-size: 9px; color: var(--yt-text-secondary); text-align: center;">Tap to select</span>
                            </div>
                            <div style="flex: 1; text-align: center; font-size: 11px; color: var(--yt-text-secondary); line-height: 14px;">
                                ${leftPercent}% ↔ ${rightPercent}%
                            </div>
                            <div style="display: flex; flex-direction: column; align-items: center; gap: 4px;">
                                <div class="topic-bubble ${state.showTopicMapRight ? 'active' : ''}" 
                                     style="background: ${trailColor}dd;"
                                     onclick="event.stopPropagation(); showTopicMap('right')">
                                    ${rightMetaCount > 0 ? rightMetaCount : '◑'}
                                </div>
                                <span style="font-size: 9px; color: var(--yt-text-secondary); text-align: center;">Tap to select</span>
                            </div>
                        </div>
                        
                        <div class="slider-container">
                            <input type="range" class="yt-slider" min="0" max="100" value="${state.focusRatio}" 
                                   oninput="updateFocus(this.value)" 
                                   style="background: linear-gradient(to right, ${trailColor} 0%, ${trailColor} ${state.focusRatio}%, ${trailColor}66 ${state.focusRatio}%, ${trailColor}66 100%);">
                        </div>
                        
                        <div class="slider-labels">
                            <span class="slider-label-text">${leftTopic} (${leftPercent}%)</span>
                            <span class="slider-label-text">${rightTopic} (${rightPercent}%)</span>
                        </div>
                        
                        <p class="slider-description">
                            ${leftPercent > 70 ? `More ${leftTopic}-focused content` : 
                              rightPercent > 70 ? `More ${rightTopic}-focused content` : 
                              `Balanced mix of ${leftTopic} and ${rightTopic}`}
                        </p>
                    </div>
                </div>
            `;
        }

        function renderChipsBar() {
            // Show trail selection chips only when Trail Feed is active
            if (state.isTrailFeed) {
                const trailChips = [
                    { id: 'Web Development Mastery', label: 'Web Dev' },
                    { id: 'Quantum Physics Explained', label: 'Science' },
                    { id: 'Mediterranean Cooking', label: 'Cooking' },
                ];

                return `
                    <div class="yt-chips-bar">
                        ${trailChips.map(chip => `
                            <button class="yt-chip has-tooltip-small ${state.activeTrail === chip.id ? 'active' : ''}" 
                                    onclick="selectTrail('${chip.id}')">
                                ${chip.label}
                                <div class="tooltip-small">📚 User-created trail for ${chip.label} content</div>
                            </button>
                        `).join('')}
                    </div>
                `;
            } else {
                // Regular feed chips
                const chips = [
                    { id: 'all', label: 'All' },
                    { id: 'following', label: 'Following' },
                    { id: 'trending', label: 'Trending' },
                ];

                return `
                    <div class="yt-chips-bar">
                        ${chips.map(chip => `
                            <button class="yt-chip ${state.selectedChip === chip.id ? 'active' : ''}" 
                                    onclick="selectChip('${chip.id}')">
                                ${chip.label}
                            </button>
                        `).join('')}
                    </div>
                `;
            }
        }

        function renderContent() {
            return `
                <div class="yt-content">
                    ${!state.isTrailFeed && state.showSuggestion && state.selectedChip === 'all' ? renderBanner() : ''}
                    ${state.isTrailFeed ? renderTopicHeader() : ''}
                    ${renderVideos()}
                    ${state.showTopicMapLeft || state.showTopicMapRight ? renderTopicMap() : ''}
                </div>
            `;
        }

        function renderOnboarding() {
            // Only show the first step (Welcome)
            const currentStep = featureDocumentation[0];

            return `
                <div class="onboarding-overlay" onclick="closeOnboardingOnOutsideClick(event)">
                    <div class="onboarding-card" onclick="event.stopPropagation()">
                        <button class="onboarding-close-btn" onclick="skipOnboarding()">×</button>
                        
                        <!-- Header -->
                        <div class="onboarding-header">
                            <span class="material-icons onboarding-icon">${currentStep.icon}</span>
                            <h2 class="onboarding-title">${currentStep.title}</h2>
                            <p class="onboarding-subtitle">${currentStep.subtitle}</p>
                        </div>

                        <!-- Content -->
                        <div class="onboarding-content">
                            ${currentStep.content}
                        </div>

                        <!-- Navigation -->
                        <div class="onboarding-actions">
                            <button class="onboarding-btn onboarding-btn-primary" onclick="finishOnboarding()">
                                Get Started!
                            </button>
                        </div>

                        <!-- Help Link -->
                        <div style="text-align: center; margin-top: 16px; font-size: 12px; color: var(--yt-text-secondary);">
                            <span style="color: var(--yt-blue); cursor: pointer;" onclick="skipOnboarding(); changeScreen('featureguide'); render();">
                                View Complete Guide
                            </span>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderBanner() {
            return `
                <div class="yt-banner">
                    <div class="yt-banner-header">
                        <span class="yt-banner-icon">🧘</span>
                        <div class="yt-banner-text">
                            <h3>Organize into a Trail?</h3>
                            <p>You've watched more than 7 videos on Yoga. Want to organize these into a Trail?</p>
                        </div>
                    </div>
                    <div class="yt-banner-actions">
                        <button class="yt-banner-btn yt-banner-btn-secondary" onclick="dismissBanner()">
                            Dismiss
                        </button>
                        <button class="yt-banner-btn yt-banner-btn-primary" onclick="changeScreen('createtrail')">
                            Create Trail
                        </button>
                    </div>
                </div>
            `;
        }

        function renderTopicHeader() {
            const trailNames = {
                'Web Development Mastery': 'Web Development',
                'Quantum Physics Explained': 'Quantum Physics',
                'Mediterranean Cooking': 'Mediterranean Cooking'
            };
            const leftPercent = state.focusRatio;
            const rightPercent = 100 - state.focusRatio;
            const leftTopic = state.selectedMainTopicLeft;
            const rightTopic = state.selectedMainTopicRight;
            
            return `
                <div id="topicHeader" style="padding: 12px 16px 8px 16px; transition: opacity 0.3s ease, max-height 0.3s ease, padding 0.3s ease; overflow: hidden;">
                    <h2 style="font-size: 18px; font-weight: 500; margin-bottom: 2px;">${trailNames[state.activeTrail]}</h2>
                    <p style="font-size: 11px; color: var(--yt-text-secondary);">
                        ${leftTopic} ${leftPercent}% ↔ ${rightPercent}% ${rightTopic} • Tap slider to adjust
                    </p>
                </div>
            `;
        }

        function renderTopicMap() {
            const side = state.showTopicMapLeft ? 'left' : 'right';
            const topicMap = topicMaps[state.activeTrail];
            const topicData = topicMap[side];
            const sideLabel = side === 'left' ? 'Left Side' : 'Right Side';
            
            const selectedMainTopic = side === 'left' ? state.selectedMainTopicLeft : state.selectedMainTopicRight;
            const selectedMetaTags = side === 'left' ? state.selectedMetaTagsLeft : state.selectedMetaTagsRight;
            const searchQuery = side === 'left' ? state.searchQueryLeft : state.searchQueryRight;
            
            // Filter topics based on search
            const filteredMainTopics = topicData.mainTopics.filter(t => 
                t.toLowerCase().includes(searchQuery.toLowerCase())
            );
            const filteredMetaTags = topicData.metaTags.filter(t => 
                t.toLowerCase().includes(searchQuery.toLowerCase())
            );
            
            return `
                <div class="topic-map-overlay" onclick="closeTopicMap()"></div>
                <div class="topic-map">
                    <div class="topic-map-header">
                        <span class="topic-map-title">${sideLabel} - Select Topic & Tags</span>
                        <button class="topic-map-close" onclick="closeTopicMap()">
                            <span class="material-icons">close</span>
                        </button>
                    </div>
                    
                    <!-- Search Bar -->
                    <input type="text" 
                           class="topic-search" 
                           placeholder="Search topics and tags..."
                           value="${searchQuery}"
                           oninput="updateSearch('${side}', this.value)"
                           onclick="event.stopPropagation()">
                    
                    <!-- Main Topics Section -->
                    <div class="topic-section-header">Main Topic (Choose One)</div>
                    <div style="margin-bottom: 16px;">
                        ${filteredMainTopics.map(topic => `
                            <div class="main-topic-item ${selectedMainTopic === topic ? 'selected' : ''}" 
                                 onclick="event.stopPropagation(); selectMainTopic('${side}', '${topic}')">
                                <div class="radio-indicator"></div>
                                <span>${topic}</span>
                            </div>
                        `).join('')}
                        ${filteredMainTopics.length === 0 ? '<p style="font-size: 12px; color: var(--yt-text-secondary); text-align: center; padding: 20px;">No topics found</p>' : ''}
                    </div>
                    
                    <!-- Meta Tags Section -->
                    <div class="topic-section-header">Refine with Tags (Multiple)</div>
                    <div class="meta-tags-grid">
                        ${filteredMetaTags.map(tag => `
                            <div class="meta-tag-item ${selectedMetaTags.includes(tag) ? 'selected' : ''}" 
                                 onclick="event.stopPropagation(); toggleMetaTag('${side}', '${tag}')">
                                <div class="checkbox-indicator"></div>
                                <span>${tag}</span>
                            </div>
                        `).join('')}
                    </div>
                    ${filteredMetaTags.length === 0 && searchQuery ? '<p style="font-size: 12px; color: var(--yt-text-secondary); text-align: center; padding: 20px;">No tags found</p>' : ''}
                    
                    <!-- Topic Connections -->
                    <div class="topic-connections">
                        <div class="topic-connections-title">📊 Topic Connections</div>
                        ${topicMap.connections.map(conn => `
                            <div class="connection-item">${conn}</div>
                        `).join('')}
                    </div>
                    
                    <!-- Info Box -->
                    <div style="margin-top: 12px; padding: 10px; background: #E8F0FE; border-radius: 8px; font-size: 11px; color: var(--yt-text-secondary); line-height: 16px;">
                        💡 <strong>Main Topic:</strong> Primary focus (one only) • <strong>Meta Tags:</strong> Refine content (multiple allowed)
                    </div>
                    
                    <!-- Summary -->
                    ${selectedMainTopic || selectedMetaTags.length > 0 ? `
                        <div style="margin-top: 12px; padding: 10px; background: #F9F9F9; border-radius: 8px;">
                            <div style="font-size: 11px; font-weight: 500; margin-bottom: 6px;">Current Selection:</div>
                            <div style="font-size: 12px; color: var(--yt-blue); margin-bottom: 4px;">
                                🎯 ${selectedMainTopic}
                            </div>
                            ${selectedMetaTags.length > 0 ? `
                                <div style="font-size: 11px; color: var(--yt-text-secondary);">
                                    + ${selectedMetaTags.length} meta tags: ${selectedMetaTags.slice(0, 2).join(', ')}${selectedMetaTags.length > 2 ? '...' : ''}
                                </div>
                            ` : ''}
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function renderVideos() {
            // Get videos based on feed type
            const videos = state.isTrailFeed 
                ? trailVideos[state.activeTrail] 
                : regularFeedVideos;
            
            return videos.map(video => {
                // Get video color
                let videoColor = '#667eea';
                
                if (state.isTrailFeed) {
                    // Trail feed: use trail color
                    const trail = mockTrails.find(t => t.name === video.trailRelevance || t.name === state.activeTrail);
                    videoColor = trail ? trail.color : '#667eea';
                } else {
                    // Regular feed: use video's unique soft pastel color
                    videoColor = video.color || '#667eea';
                }
                
                const thumbnailGradient = `linear-gradient(135deg, ${videoColor} 0%, ${videoColor}dd 100%)`;
                const avatarGradient = `linear-gradient(135deg, ${videoColor} 0%, ${videoColor}cc 100%)`;
                
                return `
                <div class="yt-video-card">
                    <div class="yt-thumbnail-container">
                        <div class="yt-thumbnail" style="background: ${thumbnailGradient};">${video.title}</div>
                        ${video.trailRelevance && state.isTrailFeed ? `
                            <div class="yt-trail-badge" style="background: ${videoColor};">
                                <span class="material-icons" style="font-size: 12px;">route</span>
                                Trail
                            </div>
                        ` : ''}
                        <div class="yt-duration">${video.duration}</div>
                    </div>
                    <div class="yt-video-info">
                        <div class="yt-video-tags">
                            ${video.tags.map(tag => `<span class="yt-tag">${tag}</span>`).join('')}
                        </div>
                        <div class="yt-video-header">
                            <div class="yt-avatar" style="background: ${avatarGradient};"></div>
                            <div class="yt-video-details">
                                <div class="yt-video-title">${video.title}</div>
                                <div class="yt-video-meta">
                                    ${video.channel} • ${video.views} • ${video.time}
                                </div>
                            </div>
                            <button class="yt-icon-btn" style="width: 32px; height: 32px;">
                                <span class="material-icons" style="font-size: 20px;">more_vert</span>
                            </button>
                        </div>
                        <div class="yt-video-actions">
                            <button class="yt-action-btn has-tooltip-small" onclick="parkVideo('${video.id}')">
                                <span class="material-icons">bookmark_border</span>
                                Park
                                <div class="tooltip-small">Park for later</div>
                            </button>
                            <button class="yt-action-btn has-tooltip-small" onclick="showAddToTrailModal('${video.id}')">
                                <span class="material-icons">add_circle_outline</span>
                                Trail
                                <div class="tooltip-small">➕ Add to Trail</div>
                            </button>
                        </div>
                    </div>
                </div>
            `}).join('');
        }

        // My Trails Screen
        function renderMyTrailsScreen() {
            return `
                <div class="yt-header">
                    <div class="yt-logo">
                        <div class="yt-logo-icon">▶</div>
                        <span class="yt-logo-text">My Trails</span>
                    </div>
                </div>
                
                <div class="yt-chips-bar">
                    <button class="yt-chip has-tooltip-small ${state.myTrailsTab === 'following' ? 'active' : ''}" 
                            onclick="changeMyTrailsTab('following')">
                        Following
                        <div class="tooltip-small">👥 Trails from community</div>
                    </button>
                    <button class="yt-chip has-tooltip-small ${state.myTrailsTab === 'created' ? 'active' : ''}" 
                            onclick="changeMyTrailsTab('created')">
                        Created
                        <div class="tooltip-small">✨ Your own Trails</div>
                    </button>
                </div>
                
                <div class="yt-content">
                    ${renderTrailsList()}
                </div>
                
                ${renderBottomNav()}
                ${state.showFeatureHelp ? renderFeatureHelpModal() : ''}
                ${state.showOnboarding ? renderOnboarding() : ''}
                
                <!-- Toast Container -->
                <div class="toast-container" id="toastContainer"></div>
            `;
        }

        function renderTrailsList() {
            const trails = state.myTrailsTab === 'following' 
                ? mockTrails.filter(t => t.following)
                : mockTrails.filter(t => t.created);

            if (trails.length === 0) {
                return `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <span class="material-icons" style="font-size: 64px; color: var(--yt-text-secondary);">explore</span>
                        </div>
                        <div class="empty-state-title">${state.myTrailsTab === 'following' ? 'No trails followed yet' : 'No trails created yet'}</div>
                        <div class="empty-state-text">
                            ${state.myTrailsTab === 'following' 
                                ? 'Discover amazing learning paths created by the community. Follow trails that interest you to see them here!' 
                                : 'Ready to share your knowledge? Create your first trail and help others learn something new.'}
                        </div>
                        ${state.myTrailsTab === 'following' ? `
                            <button class="empty-state-action" onclick="changeScreen('home')">
                                <span class="material-icons" style="font-size: 18px; margin-right: 8px;">search</span>
                                Explore Trails
                            </button>
                        ` : `
                            <button class="empty-state-action" onclick="changeScreen('createtrail')">
                                <span class="material-icons" style="font-size: 18px; margin-right: 8px;">add</span>
                                Create Your First Trail
                            </button>
                        `}
                    </div>
                `;
            }

            return trails.map(trail => {
                const gradient = `linear-gradient(135deg, ${trail.color} 0%, ${trail.color}dd 100%)`;
                const topicMap = topicMaps[trail.name];
                const leftPercent = trail.focusRatio || 70;
                const rightPercent = 100 - leftPercent;
                const leftTopic = topicMap ? topicMap.leftMain : 'Left';
                const rightTopic = topicMap ? topicMap.rightMain : 'Right';
                const avatarGradient = `linear-gradient(135deg, ${trail.color} 0%, ${trail.color}cc 100%)`;
                
                return `
                <div class="yt-trail-card" onclick="event.stopPropagation(); viewTrail('${trail.id}')">
                    <div class="yt-trail-thumbnail" style="background: ${gradient};">
                        <div class="trail-thumbnail-content">
                            <span class="material-icons" style="font-size: 48px; color: white; opacity: 0.9;">${trail.icon || 'explore'}</span>
                            <div class="trail-progress-overlay">
                                <div class="progress-circle">
                                    <span class="material-icons" style="font-size: 16px; color: white;">play_arrow</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="yt-trail-info">
                        <div class="trail-header">
                            <h3 class="yt-trail-title">${trail.name}</h3>
                            <div class="trail-creator-info">
                                <div class="creator-avatar" style="background: ${avatarGradient};"></div>
                                <div class="creator-details">
                                    <p class="yt-trail-creator">by ${trail.creator}</p>
                                    <span class="creator-verified">
                                        <span class="material-icons" style="font-size: 12px; color: var(--yt-blue);">verified</span>
                                        Verified Creator
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="yt-trail-stats">
                            <div class="stat-item">
                                <span class="material-icons" style="font-size: 16px; color: var(--yt-text-secondary);">play_circle_outline</span>
                                <span>${trail.videoCount} videos</span>
                            </div>
                            <div class="yt-trail-dot"></div>
                            <div class="stat-item">
                                <span class="material-icons" style="font-size: 16px; color: var(--yt-text-secondary);">people</span>
                                <span>${trail.followerCount.toLocaleString()}</span>
                            </div>
                            <div class="yt-trail-dot"></div>
                            <div class="stat-item">
                                <span class="material-icons" style="font-size: 16px; color: var(--yt-text-secondary);">schedule</span>
                                <span>${trail.estimatedTime}</span>
                            </div>
                        </div>
                        <div class="yt-trail-tags">
                            ${trail.tags.slice(0, 3).map(tag => `<span class="yt-tag">${tag}</span>`).join('')}
                            ${trail.tags.length > 3 ? `<span class="yt-tag-more">+${trail.tags.length - 3}</span>` : ''}
                        </div>
                        <div class="yt-trail-footer">
                            <span class="yt-focus-badge" style="background: ${trail.color}; font-size: 10px; padding: 4px 6px;">
                                ${leftTopic} ${leftPercent}% ↔ ${rightPercent}% ${rightTopic}
                            </span>
                            <span class="yt-skill-badge">${trail.skillLevel}</span>
                        </div>
                    </div>
                </div>
            `}).join('');
        }

        // Trail Detail Screen
        function renderTrailDetailScreen() {
            const trail = mockTrails.find(t => t.id === state.selectedTrail);
            if (!trail) return renderHomeScreen();

            return `
                <div class="yt-header">
                    <div class="yt-header-back">
                        <button class="yt-icon-btn" onclick="goBack()">
                            <span class="material-icons">arrow_back</span>
                        </button>
                        <span class="yt-header-title">Trail Details</span>
                    </div>
                    <button class="yt-icon-btn">
                        <span class="material-icons">more_vert</span>
                    </button>
                </div>

                <div class="yt-content">
                    <div class="trail-detail-header">
                        <h1 class="trail-detail-title">${trail.name}</h1>
                        <p style="font-size: 13px; color: var(--yt-text-secondary); margin-bottom: 8px;">by ${trail.creator}</p>
                        <p style="font-size: 14px; line-height: 20px; margin-bottom: 12px;">${trail.description}</p>
                        
                        <div class="trail-detail-stats">
                            <div class="stat-item">
                                <span class="stat-value">${trail.followerCount.toLocaleString()}</span>
                                <span class="stat-label">Followers</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value">${trail.videoCount}</span>
                                <span class="stat-label">Videos</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value">${trail.focusRatio}%</span>
                                <span class="stat-label">Focus</span>
                            </div>
                        </div>

                        <div class="trail-detail-actions">
                            <button class="btn-follow ${trail.following ? 'following' : ''}" 
                                    onclick="toggleFollow('${trail.id}')">
                                ${trail.following ? 'Following' : 'Follow'}
                            </button>
                            <button class="yt-icon-btn">
                                <span class="material-icons">${state.notifications ? 'notifications' : 'notifications_none'}</span>
                            </button>
                            <button class="yt-icon-btn">
                                <span class="material-icons">share</span>
                            </button>
                        </div>
                    </div>

                    <div class="detail-tabs">
                        <button class="detail-tab has-tooltip-small ${state.trailDetailTab === 'videos' ? 'active' : ''}" 
                                onclick="changeTrailDetailTab('videos')">
                            Videos
                            <div class="tooltip-small">🎥 All videos</div>
                        </button>
                        <button class="detail-tab has-tooltip-small ${state.trailDetailTab === 'tags' ? 'active' : ''}" 
                                onclick="changeTrailDetailTab('tags')">
                            Tags
                            <div class="tooltip-small">🏷️ Keywords</div>
                        </button>
                        <button class="detail-tab has-tooltip-small ${state.trailDetailTab === 'notes' ? 'active' : ''}" 
                                onclick="changeTrailDetailTab('notes')">
                            Notes
                            <div class="tooltip-small">📝 Annotations</div>
                        </button>
                        <button class="detail-tab has-tooltip-small ${state.trailDetailTab === 'path' ? 'active' : ''}" 
                                onclick="changeTrailDetailTab('path')">
                            Path
                            <div class="tooltip-small">🧭 Journey</div>
                        </button>
                    </div>

                    ${renderTrailDetailContent(trail)}
                </div>

                ${renderBottomNav()}
                ${state.showFeatureHelp ? renderFeatureHelpModal() : ''}
                ${state.showOnboarding ? renderOnboarding() : ''}
                
                <!-- Toast Container -->
                <div class="toast-container" id="toastContainer"></div>
            `;
        }

        function renderTrailDetailContent(trail) {
            if (state.trailDetailTab === 'videos') {
                const gradient = `linear-gradient(135deg, ${trail.color} 0%, ${trail.color}dd 100%)`;
                const avatarGradient = `linear-gradient(135deg, ${trail.color} 0%, ${trail.color}cc 100%)`;
                const videos = trailVideos[trail.name] || [];
                
                return `
                    <div style="padding: 12px 0;">
                        <div style="padding: 12px 16px; font-size: 14px; font-weight: 500;">
                            ${trail.videoCount} videos in this trail
                        </div>
                        ${videos.map(v => `
                            <div class="yt-video-card">
                                <div class="yt-thumbnail-container">
                                    <div class="yt-thumbnail" style="background: ${gradient};">${v.title}</div>
                                    <div class="yt-duration">${v.duration}</div>
                                </div>
                                <div class="yt-video-info">
                                    <div class="yt-video-tags">
                                        ${v.tags.map(tag => `<span class="yt-tag">${tag}</span>`).join('')}
                                    </div>
                                    <div class="yt-video-header">
                                        <div class="yt-avatar" style="background: ${avatarGradient};"></div>
                                        <div class="yt-video-details">
                                            <div class="yt-video-title">${v.title}</div>
                                            <div class="yt-video-meta">${v.channel} • ${v.views}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            } else if (state.trailDetailTab === 'tags') {
                return `
                    <div style="padding: 20px 16px;">
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            ${trail.tags.map(tag => `
                                <span style="padding: 10px 16px; background: ${trail.color}; color: white; 
                                      border-radius: 20px; font-size: 14px;">${tag}</span>
                            `).join('')}
                        </div>
                    </div>
                `;
            } else if (state.trailDetailTab === 'notes') {
                return `
                    <div style="padding: 16px;">
                        <div style="padding: 16px; background: #F9F9F9; border-radius: 12px; line-height: 20px; white-space: pre-line; font-size: 13px;">
                            ${trail.notes}
                        </div>
                        
                        <div style="margin-top: 16px; padding: 12px; background: #E8F0FE; border-radius: 8px;">
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                <span class="material-icons" style="font-size: 20px; color: var(--yt-blue);">edit_note</span>
                                <span style="font-size: 13px; font-weight: 500;">Add Your Notes</span>
                            </div>
                            <textarea placeholder="Add personal notes about this trail..." 
                                      style="width: 100%; min-height: 80px; padding: 10px; border: 1px solid var(--yt-divider); 
                                             border-radius: 8px; font-size: 13px; font-family: 'Roboto', sans-serif;"></textarea>
                        </div>
                    </div>
                `;
            } else if (state.trailDetailTab === 'path') {
                if (!trail.pathData || trail.pathData.length === 0) {
                    return `
                        <div class="empty-state">
                            <div class="empty-state-icon">
                                <span class="material-icons" style="font-size: 64px; color: var(--yt-text-secondary);">timeline</span>
                            </div>
                            <div class="empty-state-title">Your learning journey starts here</div>
                            <div class="empty-state-text">As you watch videos in this trail, your progress will be tracked here. See how far you've come and what's next in your learning path!</div>
                        </div>
                    `;
                }
                
                const completedCount = trail.pathData.filter(v => v.completed).length;
                const totalCount = trail.pathData.length;
                const progressPercent = Math.round((completedCount / totalCount) * 100);
                
                return `
                    <div style="padding: 16px;">
                        <!-- Progress Bar -->
                        <div style="margin-bottom: 20px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span style="font-size: 13px; font-weight: 500;">Trail Progress</span>
                                <span style="font-size: 13px; color: var(--yt-blue); font-weight: 500;">
                                    ${completedCount}/${totalCount} completed (${progressPercent}%)
                                </span>
                            </div>
                            <div style="height: 8px; background: #E0E0E0; border-radius: 4px; overflow: hidden;">
                                <div style="height: 100%; width: ${progressPercent}%; background: ${trail.color}; transition: width 0.3s ease;"></div>
                            </div>
                        </div>
                        
                        <!-- Path Items -->
                        <div style="position: relative; padding-left: 24px;">
                            ${trail.pathData.map((item, index) => `
                                <div style="position: relative; margin-bottom: 20px;">
                                    <!-- Timeline dot -->
                                    <div style="position: absolute; left: -24px; top: 4px; width: 16px; height: 16px; 
                                                background: ${item.completed ? trail.color : '#E0E0E0'}; 
                                                border: 3px solid white; border-radius: 50%; box-shadow: 0 0 0 2px ${item.completed ? trail.color : '#E0E0E0'};"></div>
                                    
                                    <!-- Timeline line -->
                                    ${index < trail.pathData.length - 1 ? `
                                        <div style="position: absolute; left: -16px; top: 20px; width: 2px; height: calc(100% + 10px); 
                                                    background: ${item.completed && trail.pathData[index + 1].completed ? trail.color : '#E0E0E0'};"></div>
                                    ` : ''}
                                    
                                    <!-- Video Info -->
                                    <div style="padding: 12px; background: ${item.completed ? '#F9F9F9' : 'white'}; 
                                                border-radius: 8px; border: 1px solid var(--yt-divider);">
                                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 4px;">
                                            <span style="font-size: 13px; font-weight: 500; ${item.completed ? 'color: var(--yt-text-primary)' : 'color: var(--yt-text-secondary)'};">
                                                ${item.video}
                                            </span>
                                            ${item.completed ? `
                                                <span class="material-icons" style="font-size: 18px; color: ${trail.color};">check_circle</span>
                                            ` : ''}
                                        </div>
                                        <div style="display: flex; gap: 12px; font-size: 11px; color: var(--yt-text-secondary);">
                                            <span>⏱️ ${item.duration}</span>
                                            ${item.date ? `<span>✓ ${item.date}</span>` : '<span style="color: var(--yt-blue);">Up next</span>'}
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <!-- Path Summary -->
                        <div style="margin-top: 16px; padding: 12px; background: #E8F0FE; border-radius: 8px; font-size: 12px; line-height: 18px; color: var(--yt-text-secondary);">
                            📊 Your learning journey is ${progressPercent}% complete. Keep going!
                        </div>
                    </div>
                `;
            }
            
            // Fallback
            return '<div></div>';
        }

        // Parked Videos Screen
        function renderParkedScreen() {
            const toWatch = mockParkedVideos.filter(v => !v.watched);
            const watched = mockParkedVideos.filter(v => v.watched);

            return `
                <div class="yt-header">
                    <div class="yt-logo">
                        <div class="yt-logo-icon">▶</div>
                        <span class="yt-logo-text">Parked Videos</span>
                    </div>
                </div>

                <div class="summary-bar">
                    <div class="summary-item">
                        <span class="summary-value">${toWatch.length}</span>
                        <span class="summary-label">To Watch</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-value">${toWatch.reduce((sum, v) => {
                            const [min] = v.duration.split(':').map(Number);
                            return sum + min;
                        }, 0)}m</span>
                        <span class="summary-label">Total Time</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-value">${watched.length}</span>
                        <span class="summary-label">Watched</span>
                    </div>
                </div>

                <div class="yt-chips-bar">
                    <button class="yt-chip has-tooltip-small ${state.parkedTab === 'towatch' ? 'active' : ''}" 
                            onclick="changeParkedTab('towatch')">
                        To Watch (${toWatch.length})
                        <div class="tooltip-small">⏱️ Parked for later</div>
                    </button>
                    <button class="yt-chip has-tooltip-small ${state.parkedTab === 'watched' ? 'active' : ''}" 
                            onclick="changeParkedTab('watched')">
                        Watched (${watched.length})
                        <div class="tooltip-small">✅ Already watched</div>
                    </button>
                </div>

                <div class="yt-content">
                    ${renderParkedVideos()}
                </div>

                ${renderBottomNav()}
                ${state.showFeatureHelp ? renderFeatureHelpModal() : ''}
                ${state.showOnboarding ? renderOnboarding() : ''}
                
                <!-- Toast Container -->
                <div class="toast-container" id="toastContainer"></div>
            `;
        }

        function renderParkedVideos() {
            const videos = state.parkedTab === 'towatch' 
                ? mockParkedVideos.filter(v => !v.watched)
                : mockParkedVideos.filter(v => v.watched);

            if (videos.length === 0) {
                return `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <span class="material-icons" style="font-size: 64px; color: var(--yt-text-secondary);">bookmark_border</span>
                        </div>
                        <div class="empty-state-title">Your watchlist is empty</div>
                        <div class="empty-state-text">Found something interesting? Park videos from your feed to create a personalized watchlist. No more losing track of great content!</div>
                        <button class="empty-state-action" onclick="changeScreen('home')">
                            <span class="material-icons" style="font-size: 18px; margin-right: 8px;">home</span>
                            Browse Videos
                        </button>
                    </div>
                `;
            }

            return videos.map(video => `
                <div class="parked-video-item">
                    <div class="parked-header">
                        <div class="parked-thumbnail">
                            <div class="yt-duration">${video.duration}</div>
                        </div>
                        <div class="parked-info">
                            <div class="parked-title">${video.title}</div>
                            <div style="font-size: 12px; color: var(--yt-text-secondary); margin-top: 4px;">
                                ${video.channel}
                            </div>
                        </div>
                    </div>
                    ${video.notes ? `<div class="parked-notes">📝 ${video.notes}</div>` : ''}
                    <div class="yt-video-actions">
                        <button class="yt-action-btn" onclick="showAddToTrailModal('${video.id}')">
                            <span class="material-icons">add_circle_outline</span>
                            Add to Trail
                        </button>
                        <button class="yt-action-btn">
                            <span class="material-icons">${video.watched ? 'check_circle' : 'play_circle'}</span>
                            ${video.watched ? 'Watched' : 'Watch'}
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Create Trail Screen
        function renderCreateTrailScreen() {
            return `
                <div class="yt-header">
                    <div class="yt-header-back">
                        <button class="yt-icon-btn" onclick="goBack()">
                            <span class="material-icons">close</span>
                        </button>
                        <span class="yt-header-title">Create Trail</span>
                    </div>
                </div>

                <div class="yt-content">
                    <div style="padding: 16px;">
                        <div class="form-group">
                            <label class="form-label">Trail Name *</label>
                            <input type="text" class="form-input" placeholder="e.g., Web Development Mastery"
                                   value="${state.createTrailData.name}" 
                                   oninput="updateCreateTrailField('name', this.value)">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Description *</label>
                            <textarea class="form-input form-textarea" 
                                      placeholder="Describe what this trail covers..."
                                      oninput="updateCreateTrailField('description', this.value)">${state.createTrailData.description}</textarea>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Topic *</label>
                            <div class="yt-chips-bar" style="padding: 0; border: none;">
                                ${['Technology', 'Science', 'Cooking', 'Education', 'Entertainment'].map(topic => `
                                    <button class="yt-chip ${state.createTrailData.topic === topic ? 'active' : ''}"
                                            onclick="updateCreateTrailField('topic', '${topic}')">
                                        ${topic}
                                    </button>
                                `).join('')}
                            </div>
                        </div>


                        <div class="form-group">
                            <label class="form-label">Content Focus</label>
                            
                            <!-- Custom Two-Topic Selection for Create Trail -->
                            <div style="background: #F8F9FA; border: 1px solid #E9ECEF; border-radius: 8px; padding: 16px; margin: 8px 0;">
                                <div style="text-align: center; margin-bottom: 16px;">
                                    <span style="font-size: 12px; color: var(--yt-text-secondary);">Choose two topics to blend in your trail</span>
                                </div>
                                
                                <!-- Topic Selection Cards -->
                                <div style="display: flex; gap: 12px; margin-bottom: 16px;">
                                    <!-- Left Topic Card -->
                                    <div style="flex: 1; background: white; border: 2px solid ${state.createTrailData.leftTopic ? 'var(--yt-blue)' : '#E9ECEF'}; border-radius: 8px; padding: 12px; text-align: center; cursor: pointer; transition: all 0.2s ease;"
                                         onclick="showCreateTrailTopicMap('left')">
                                        <div style="font-size: 24px; margin-bottom: 8px;">
                                            ${state.createTrailData.leftTopic ? state.createTrailData.leftTopic.charAt(0) : '📚'}
                                        </div>
                                        <div style="font-size: 12px; font-weight: 500; color: ${state.createTrailData.leftTopic ? 'var(--yt-text-primary)' : 'var(--yt-text-secondary)'};">
                                            ${state.createTrailData.leftTopic || 'Select Topic'}
                                        </div>
                                    </div>
                                    
                                    <!-- VS Separator -->
                                    <div style="display: flex; align-items: center; justify-content: center; color: var(--yt-text-secondary); font-size: 14px; font-weight: 500;">
                                        VS
                                    </div>
                                    
                                    <!-- Right Topic Card -->
                                    <div style="flex: 1; background: white; border: 2px solid ${state.createTrailData.rightTopic ? 'var(--yt-blue)' : '#E9ECEF'}; border-radius: 8px; padding: 12px; text-align: center; cursor: pointer; transition: all 0.2s ease;"
                                         onclick="showCreateTrailTopicMap('right')">
                                        <div style="font-size: 24px; margin-bottom: 8px;">
                                            ${state.createTrailData.rightTopic ? state.createTrailData.rightTopic.charAt(0) : '📚'}
                                        </div>
                                        <div style="font-size: 12px; font-weight: 500; color: ${state.createTrailData.rightTopic ? 'var(--yt-text-primary)' : 'var(--yt-text-secondary)'};">
                                            ${state.createTrailData.rightTopic || 'Select Topic'}
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Focus Slider -->
                                ${state.createTrailData.leftTopic && state.createTrailData.rightTopic ? `
                                    <div style="background: white; border-radius: 8px; padding: 12px;">
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                            <span style="font-size: 12px; font-weight: 500; color: var(--yt-text-primary);">Focus Balance</span>
                                            <span style="font-size: 12px; font-weight: 500; color: var(--yt-blue);">${state.createTrailData.focusRatio}% ↔ ${100 - state.createTrailData.focusRatio}%</span>
                                        </div>
                                        <input type="range" class="form-slider" min="0" max="100" 
                                               value="${state.createTrailData.focusRatio}" 
                                               oninput="updateCreateTrailField('focusRatio', this.value)">
                                        <div style="display: flex; justify-content: space-between; font-size: 10px; color: var(--yt-text-secondary); margin-top: 4px;">
                                            <span>${state.createTrailData.leftTopic}</span>
                                            <span>${state.createTrailData.rightTopic}</span>
                                        </div>
                                    </div>
                                ` : `
                                    <div style="text-align: center; padding: 20px; color: var(--yt-text-secondary); font-size: 12px;">
                                        Select both topics to adjust focus balance
                                    </div>
                                `}
                            </div>
                        </div>

                        <div style="padding: 16px; background: #E8F0FE; margin: 0 16px; border-radius: 12px;">
                            <p style="font-size: 13px; line-height: 18px; color: var(--yt-text-secondary);">
                                💡 Your trail will recommend videos based on these settings. You can adjust them later.
                            </p>
                        </div>
                    </div>
                </div>

                <div class="fixed-submit">
                    <button class="btn-submit" 
                            ${!isCreateTrailValid() ? 'disabled' : ''}
                            onclick="createTrail()">
                        Create Trail
                    </button>
                </div>
                ${state.showFeatureHelp ? renderFeatureHelpModal() : ''}
                ${state.showOnboarding ? renderOnboarding() : ''}
                ${state.showCreateTrailTopicMap ? renderCreateTrailTopicMap() : ''}
                
                <!-- Toast Container -->
                <div class="toast-container" id="toastContainer"></div>
            `;
        }

        // Profile Screen
        function renderProfileScreen() {
            return `
                <div class="yt-header">
                    <div class="yt-logo">
                        <div class="yt-logo-icon">▶</div>
                        <span class="yt-logo-text">Profile & Settings</span>
                    </div>
                </div>

                <div class="yt-content">
                    <div style="padding: 20px 16px; text-align: center; border-bottom: 1px solid var(--yt-divider);">
                        <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                                    border-radius: 50%; margin: 0 auto 12px;"></div>
                        <div style="font-size: 18px; font-weight: 500; margin-bottom: 4px;">Your Name</div>
                        <div style="font-size: 14px; color: var(--yt-text-secondary);">user@example.com</div>
                    </div>

                    <div class="settings-list">
                        <div class="settings-item" onclick="alert('My Trails: ${mockTrails.length} created, ${mockTrails.filter(t => t.following).length} following')">
                            <span class="settings-label">My Trails Summary</span>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span class="settings-value">${mockTrails.length} trails</span>
                                <span class="material-icons" style="font-size: 20px; color: var(--yt-text-secondary);">
                                    chevron_right
                                </span>
                            </div>
                        </div>

                        <div class="settings-item">
                            <span class="settings-label">Notification Settings</span>
                            <div class="yt-toggle ${state.notifications ? 'active' : ''}" 
                                 onclick="toggleNotifications()">
                                <div class="yt-toggle-thumb"></div>
                            </div>
                        </div>

                        <div class="settings-item" onclick="showFocusDefaultModal()">
                            <span class="settings-label">Default Focus Ratio</span>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span class="settings-value">${state.focusDefault}%</span>
                                <span class="material-icons" style="font-size: 20px; color: var(--yt-text-secondary);">
                                    chevron_right
                                </span>
                            </div>
                        </div>

                        <div class="settings-item">
                            <span class="settings-label">Parked Videos</span>
                            <span class="settings-value">${mockParkedVideos.length} videos</span>
                        </div>

                        <div class="settings-item">
                            <span class="settings-label">Privacy & Data</span>
                            <span class="material-icons" style="font-size: 20px; color: var(--yt-text-secondary);">
                                chevron_right
                            </span>
                        </div>

                        <div style="padding: 12px 16px; background: #E8F0FE; border-bottom: 1px solid var(--yt-divider);">
                            <div style="font-size: 13px; font-weight: 500; margin-bottom: 4px; color: var(--yt-text-primary);">🎓 Onboarding</div>
                            <div style="font-size: 11px; color: var(--yt-text-secondary); line-height: 16px;">
                                Choose how you want to learn about features
                            </div>
                        </div>


                        <div class="settings-item" onclick="changeScreen('featureguide')">
                            <div>
                                <div class="settings-label">Complete Guide</div>
                                <div style="font-size: 11px; color: var(--yt-text-secondary);">All 10 features • Scrollable</div>
                            </div>
                            <span class="material-icons" style="font-size: 20px; color: var(--yt-text-secondary);">
                                menu_book
                            </span>
                        </div>

                        <div class="settings-item">
                            <span class="settings-label">Feedback</span>
                            <span class="material-icons" style="font-size: 20px; color: var(--yt-text-secondary);">
                                feedback
                            </span>
                        </div>

                        <div class="settings-item" onclick="logout()">
                            <span class="settings-label" style="color: var(--yt-red);">Log Out</span>
                        </div>
                    </div>
                </div>

                ${renderBottomNav()}
                ${state.showFeatureHelp ? renderFeatureHelpModal() : ''}
                ${state.showOnboarding ? renderOnboarding() : ''}
                
                <!-- Toast Container -->
                <div class="toast-container" id="toastContainer"></div>
            `;
        }

        // Complete Guide Screen (Scrollable Documentation)
        function renderFeatureGuideScreen() {
            return `
                <div class="yt-header">
                    <div class="yt-header-back">
                        <button class="yt-icon-btn" onclick="goBack()">
                            <span class="material-icons">arrow_back</span>
                        </button>
                        <span class="yt-header-title">Complete Guide</span>
                    </div>
                </div>

                <div class="yt-content">
                    <!-- Breadcrumb Navigation -->
                    <div style="padding: 12px 16px; background: #F8F9FA; border-bottom: 1px solid var(--yt-divider);">
                        <div style="display: flex; align-items: center; gap: 8px; font-size: 13px; color: var(--yt-text-secondary);">
                            <span style="cursor: pointer; color: var(--yt-blue);" onclick="changeScreen('profile')">Profile</span>
                            <span class="material-icons" style="font-size: 16px; color: var(--yt-text-secondary);">chevron_right</span>
                            <span style="color: var(--yt-text-primary); font-weight: 500;">Complete Guide</span>
                        </div>
                    </div>

                    <div style="padding: 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                        <div style="font-size: 16px; font-weight: 500; margin-bottom: 8px;">📖 Complete Feature Guide</div>
                        <div style="font-size: 13px; line-height: 20px; opacity: 0.95;">
                            Scroll through all features at your own pace. Read what you need, skip what you don't.
                        </div>
                    </div>

                    <!-- All 10 cards in scrollable format -->
                    ${featureDocumentation.map((doc, index) => `
                        <div style="padding: 20px 16px; border-bottom: 1px solid var(--yt-divider); background: ${index % 2 === 0 ? 'white' : '#FAFAFA'};">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                <span class="material-icons" style="font-size: 36px; color: var(--yt-blue);">${doc.icon}</span>
                                <div>
                                    <h3 style="font-size: 18px; font-weight: 500; margin-bottom: 2px;">${doc.title}</h3>
                                    <p style="font-size: 12px; color: var(--yt-text-secondary);">${doc.subtitle}</p>
                                </div>
                            </div>
                            <div style="margin-left: 48px;">
                                ${doc.content}
                            </div>
                        </div>
                    `).join('')}

                    <div style="padding: 24px 16px; background: #E8F0FE; text-align: center;">
                        <div style="font-size: 14px; font-weight: 500; margin-bottom: 8px;">🎉 That's Everything!</div>
                        <div style="font-size: 12px; color: var(--yt-text-secondary); line-height: 18px; margin-bottom: 16px;">
                            You now know all the features. Start exploring and look for ℹ️ icons for quick reminders!
                        </div>
                        <button class="onboarding-btn onboarding-btn-primary" onclick="changeScreen('home'); state.isTrailFeed = true; render();" style="width: auto; padding: 10px 24px;">
                            Start Using Trails
                        </button>
                    </div>
                </div>

                ${renderBottomNav()}
                ${state.showFeatureHelp ? renderFeatureHelpModal() : ''}
            `;
        }

        // Bottom Navigation
        function renderBottomNav() {
            // Calculate badge counts
            const parkedCount = state.parkedVideos ? state.parkedVideos.length : 0;
            const trailsCount = mockTrails.filter(t => t.following).length;
            
            const navItems = [
                { id: 'home', screen: 'home', icon: 'home', label: 'Home', tooltip: '🏠 Home Feed - Browse videos' },
                { id: 'trails', screen: 'mytrails', icon: 'play_circle', label: 'Trails', tooltip: '🗺️ My Trails - Following & Created', badge: trailsCount > 0 ? trailsCount : null },
                { id: 'add', screen: 'createtrail', icon: 'add_circle_outline', label: '', tooltip: '➕ Create new Trail' },
                { id: 'parked', screen: 'parked', icon: 'bookmark_border', label: 'Parked', tooltip: '📑 Parked Videos - Watch Later', badge: parkedCount > 0 ? parkedCount : null },
                { id: 'profile', screen: 'profile', icon: 'account_circle', label: 'You', tooltip: '👤 Profile & Settings' },
            ];

            return `
                <div class="yt-bottom-nav">
                    ${navItems.map(item => `
                        <button class="yt-nav-item has-tooltip-small ${state.currentBottomTab === item.id ? 'active' : ''}" 
                                onclick="changeBottomTab('${item.id}', '${item.screen}')">
                            <span class="material-icons">${item.icon}</span>
                            ${item.label ? `<span class="yt-nav-label">${item.label}</span>` : ''}
                            ${item.badge ? `<span class="nav-badge">${item.badge}</span>` : ''}
                            <div class="tooltip-small">${item.tooltip}</div>
                        </button>
                    `).join('')}
                </div>
            `;
        }

        // Actions
        function changeScreen(screen) {
            state.currentScreen = screen;
            render();
        }

        function goBack() {
            if (state.currentScreen === 'traildetail') {
                state.currentScreen = 'mytrails';
            } else {
                state.currentScreen = 'home';
            }
            render();
        }

        function toggleFeed() {
            console.log('toggleFeed called, current state:', state.isTrailFeed);
            state.isTrailFeed = !state.isTrailFeed;
            state.focusSliderExpanded = false; // Collapse slider when switching
            
            // Show contextual onboarding for feed toggle
            showContextualOnboarding('feedToggle');
            
            render();
        }

        function selectChip(chipId) {
            state.selectedChip = chipId;
            render();
        }

        function selectTrail(trailName) {
            state.activeTrail = trailName;
            // Reset to default main topics for this trail
            const topicMap = topicMaps[trailName];
            state.selectedMainTopicLeft = topicMap.leftMain;
            state.selectedMainTopicRight = topicMap.rightMain;
            state.selectedMetaTagsLeft = [];
            state.selectedMetaTagsRight = [];
            state.searchQueryLeft = '';
            state.searchQueryRight = '';
            
            render();
        }

        function toggleSlider() {
            state.focusSliderExpanded = !state.focusSliderExpanded;
            
            // Show contextual onboarding for content slider when expanding
            if (state.focusSliderExpanded) {
                showContextualOnboarding('contentSlider');
            }
            
            render();
        }

        function showTopicMap(side) {
            if (side === 'left') {
                state.showTopicMapLeft = true;
                state.showTopicMapRight = false;
            } else {
                state.showTopicMapLeft = false;
                state.showTopicMapRight = true;
            }
            render();
        }

        function closeTopicMap() {
            state.showTopicMapLeft = false;
            state.showTopicMapRight = false;
            // Clear search when closing
            state.searchQueryLeft = '';
            state.searchQueryRight = '';
            // Now do full render to update slider labels
            render();
        }

        function selectMainTopic(side, topic) {
            if (side === 'left') {
                state.selectedMainTopicLeft = topic;
            } else {
                state.selectedMainTopicRight = topic;
            }
            // Update only the modal content, not full page
            updateModalOnly();
            showToast(`🎯 ${side} topic set to ${topic}`, 'info');
        }

        function toggleMetaTag(side, tag) {
            if (side === 'left') {
                const index = state.selectedMetaTagsLeft.indexOf(tag);
                if (index > -1) {
                    state.selectedMetaTagsLeft.splice(index, 1);
                } else {
                    state.selectedMetaTagsLeft.push(tag);
                }
            } else {
                const index = state.selectedMetaTagsRight.indexOf(tag);
                if (index > -1) {
                    state.selectedMetaTagsRight.splice(index, 1);
                } else {
                    state.selectedMetaTagsRight.push(tag);
                }
            }
            // Update only the modal content, not full page
            updateModalOnly();
        }

        function updateSearch(side, query) {
            if (side === 'left') {
                state.searchQueryLeft = query;
            } else {
                state.searchQueryRight = query;
            }
            // Update only the modal content, not full page
            updateModalOnly();
        }

        function updateModalOnly() {
            // Only update the modal content without full page re-render
            const existingModal = document.querySelector('.topic-map');
            if (existingModal) {
                const modalHTML = renderTopicMap();
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = modalHTML;
                const newModal = tempDiv.querySelector('.topic-map');
                if (newModal) {
                    existingModal.innerHTML = newModal.innerHTML;
                }
            }
        }

        function updateFocus(value) {
            state.focusRatio = parseInt(value);
            const leftPercent = state.focusRatio;
            const rightPercent = 100 - state.focusRatio;
            const leftTopic = state.selectedMainTopicLeft || 'Left';
            const rightTopic = state.selectedMainTopicRight || 'Right';
            showToast(`⚖️ Mix: ${leftPercent}% ${leftTopic} ↔ ${rightPercent}% ${rightTopic}`, 'info', 2000);
            render();
        }

        function toggleSlider() {
            state.focusSliderExpanded = !state.focusSliderExpanded;
            
            // Show contextual onboarding for content slider when expanding
            if (state.focusSliderExpanded) {
                showContextualOnboarding('contentSlider');
            }
            
            // Dynamically manage z-index based on slider state
            setTimeout(() => {
                const chipsBar = document.querySelector('.yt-chips-bar');
                if (chipsBar) {
                    if (state.focusSliderExpanded) {
                        // Slider expanded: chips behind (lower z-index)
                        chipsBar.style.zIndex = '200';
                    } else {
                        // Slider collapsed: chips on top (higher z-index)
                        chipsBar.style.zIndex = '300';
                    }
                }
            }, 10);
            
            render();
        }

        function dismissBanner() {
            state.showSuggestion = false;
            render();
        }

        function changeBottomTab(tabId, screen) {
            state.currentBottomTab = tabId;
            state.currentScreen = screen;
            render();
        }

        function parkVideo(videoId) {
            // Show contextual onboarding for parked videos
            showContextualOnboarding('parkedVideos');
            
            // Add to parked videos (mock)
            if (!state.parkedVideos) state.parkedVideos = [];
            
            // Find video in all possible arrays
            let video = null;
            if (state.isTrailFeed && trailVideos[state.activeTrail]) {
                video = trailVideos[state.activeTrail].find(v => v.id === videoId);
            }
            if (!video) {
                video = regularFeedVideos.find(v => v.id === videoId);
            }
            
            if (video && !state.parkedVideos.find(v => v.id === videoId)) {
                state.parkedVideos.push(video);
                showToast('📌 Video parked! Check Parked tab', 'success');
            } else if (state.parkedVideos.find(v => v.id === videoId)) {
                showToast('📌 Video already parked!', 'info');
            } else {
                showToast('❌ Video not found', 'info');
            }
        }

        function showAddToTrailModal(videoId) {
            const trailNames = mockTrails.map(t => t.name).join('\n');
            showToast('✅ Added to Web Dev trail', 'success');
        }

        function viewTrail(trailId) {
            console.log('viewTrail called with:', trailId);
            state.selectedTrail = trailId;
            state.currentScreen = 'traildetail';
            
            // Show contextual onboarding for trail details when clicking from My Trails
            showContextualOnboarding('trailDetails');
            
            render();
        }

        function changeTrailDetailTab(tab) {
            state.trailDetailTab = tab;
            
            // Show contextual onboarding for specific tabs
            if (tab === 'path') {
                showContextualOnboarding('trailPath');
            } else if (tab === 'notes') {
                showContextualOnboarding('notes');
            }
            
            render();
        }

        function toggleFollow(trailId) {
            const trail = mockTrails.find(t => t.id === trailId);
            if (trail) {
                trail.following = !trail.following;
                
                // Show contextual onboarding for follow trails when following
                if (trail.following) {
                    showContextualOnboarding('followTrails');
                }
                
                render();
            }
        }

        function changeMyTrailsTab(tab) {
            state.myTrailsTab = tab;
            render();
        }

        function changeParkedTab(tab) {
            state.parkedTab = tab;
            render();
        }

        function updateCreateTrailField(field, value) {
            state.createTrailData[field] = value;
            render();
        }

        function showCreateTrailTopicMap(side) {
            // Set up topic map for Create Trail
            state.showCreateTrailTopicMap = true;
            state.createTrailTopicMapSide = side;
            render();
        }

        function closeCreateTrailTopicMap() {
            state.showCreateTrailTopicMap = false;
            render();
        }

        function selectCreateTrailTopic(topic) {
            const side = state.createTrailTopicMapSide;
            if (side === 'left') {
                state.createTrailData.leftTopic = topic;
            } else {
                state.createTrailData.rightTopic = topic;
            }
            closeCreateTrailTopicMap();
        }

        function renderCreateTrailTopicMap() {
            const side = state.createTrailTopicMapSide;
            const sideLabel = side === 'left' ? 'Left Topic' : 'Right Topic';
            const topics = ['React', 'Node.js', 'Python', 'JavaScript', 'Vue', 'Angular', 'TypeScript', 'Express', 'Django', 'Flask'];
            
            return `
                <div class="topic-map-overlay" onclick="closeCreateTrailTopicMap()"></div>
                <div class="topic-map">
                    <div class="topic-map-header">
                        <span class="topic-map-title">${sideLabel}</span>
                        <button class="topic-map-close" onclick="closeCreateTrailTopicMap()">
                            <span class="material-icons">close</span>
                        </button>
                    </div>
                    <div class="topic-map-content">
                        <div class="main-topics-section">
                            <div style="font-size: 12px; font-weight: 500; margin-bottom: 8px; color: var(--yt-text-primary);">Select Main Topic</div>
                            <div class="main-topics-list">
                                ${topics.map(topic => `
                                    <div class="main-topic-item ${(side === 'left' ? state.createTrailData.leftTopic : state.createTrailData.rightTopic) === topic ? 'selected' : ''}" 
                                         onclick="selectCreateTrailTopic('${topic}')">
                                        <div class="radio-indicator"></div>
                                        <span>${topic}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function isCreateTrailValid() {
            return state.createTrailData.name.trim() && 
                   state.createTrailData.description.trim() && 
                   state.createTrailData.topic;
        }

        function createTrail() {
            if (!isCreateTrailValid()) return;
            
            // Show contextual onboarding for create trail
            showContextualOnboarding('createTrail');
            
            alert(`Trail Created!\n\nName: ${state.createTrailData.name}\nTopic: ${state.createTrailData.topic}\nFocus: ${state.createTrailData.focusRatio}%`);
            
            // Reset form
            state.createTrailData = {
                name: '',
                description: '',
                topic: '',
                region: 'Global',
                skillLevel: 'Beginner',
                focusRatio: 70,
            };
            
            state.currentScreen = 'mytrails';
            state.myTrailsTab = 'created';
            render();
        }

        function toggleNotifications() {
            state.notifications = !state.notifications;
            render();
        }

        function showFocusDefaultModal() {
            const newValue = prompt('Set default focus ratio (0-100):', state.focusDefault);
            if (newValue !== null) {
                const val = parseInt(newValue);
                if (val >= 0 && val <= 100) {
                    state.focusDefault = val;
                    render();
                }
            }
        }

        function logout() {
            if (confirm('Are you sure you want to log out?')) {
                alert('Logged out successfully!');
            }
        }

        // Onboarding Navigation
        function onboardingNext() {
            if (state.onboardingStep < featureDocumentation.length - 1) {
                state.onboardingStep++;
                render();
            }
        }

        function onboardingBack() {
            if (state.onboardingStep > 0) {
                state.onboardingStep--;
                render();
            }
        }

        function skipOnboarding() {
            state.showOnboarding = false;
            render();
        }

        function closeOnboardingOnOutsideClick(event) {
            if (event.target === event.currentTarget) {
                skipOnboarding();
            }
        }

        function finishOnboarding() {
            state.showOnboarding = false;
            // Auto-enable Trail Feed to show the main feature
            state.isTrailFeed = true;
            render();
        }

        function restartOnboarding() {
            state.showOnboarding = true;
            state.onboardingStep = 0;
            render();
        }

        // Contextual Onboarding Functions
        function showContextualOnboarding(featureKey) {
            // Check if this is the first time using this feature
            if (!state.contextualOnboarding[featureKey]) {
                const stepIndex = featureToOnboardingStep[featureKey];
                if (stepIndex && featureDocumentation[stepIndex]) {
                    // Mark as used
                    state.contextualOnboarding[featureKey] = true;
                    saveState();
                    
                    // Show the contextual onboarding card
                    showContextualCard(stepIndex);
                }
            }
        }

        function showContextualCard(stepIndex) {
            const step = featureDocumentation[stepIndex];
            if (!step) return;

            // Create contextual onboarding card
            const contextualCard = document.createElement('div');
            contextualCard.className = 'contextual-onboarding-card';
            contextualCard.innerHTML = `
                <div class="contextual-card-content">
                    <button class="contextual-close-btn" onclick="closeContextualCard()">×</button>
                    <div class="contextual-header">
                        <div class="contextual-icon">
                            <span class="material-icons">${step.icon}</span>
                        </div>
                        <div class="contextual-title">${step.title}</div>
                        <div class="contextual-subtitle">${step.subtitle}</div>
                    </div>
                    <div class="contextual-body">
                        ${step.content}
                    </div>
                    <div class="contextual-actions">
                        <button class="contextual-btn contextual-btn-primary" onclick="closeContextualCard()">
                            Got it!
                        </button>
                    </div>
                </div>
            `;

            // Add to page
            document.body.appendChild(contextualCard);
        }

        function closeContextualCard() {
            const card = document.querySelector('.contextual-onboarding-card');
            if (card) {
                // Add fade out animation
                card.style.animation = 'fadeOutContextual 0.3s ease forwards';
                setTimeout(() => {
                    card.remove();
                }, 300);
            }
        }

        // Feature Help Functions
        function showFeatureHelp(featureKey) {
            state.showFeatureHelp = featureKey;
            render();
        }

        function closeFeatureHelp() {
            state.showFeatureHelp = null;
            render();
        }

        function renderFeatureHelpModal() {
            if (!state.showFeatureHelp || !featureHelp[state.showFeatureHelp]) return '';
            
            const help = featureHelp[state.showFeatureHelp];
            
            return `
                <div class="feature-help-overlay" onclick="closeFeatureHelp()">
                    <div class="feature-help-modal" onclick="event.stopPropagation()">
                        <div class="feature-help-header">
                            <span class="feature-help-title">${help.title}</span>
                            <button class="yt-icon-btn" style="width: 28px; height: 28px;" onclick="closeFeatureHelp()">
                                <span class="material-icons" style="font-size: 18px;">close</span>
                            </button>
                        </div>
                        <div class="feature-help-text">${help.text}</div>
                    </div>
                </div>
            `;
        }

        let lastScrollTop = 0;
        let scrollListenerAdded = false;

        // Toast Notification System
        function showToast(message, type = 'info', duration = 3000) {
            const container = document.getElementById('toastContainer');
            if (!container) return;
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            
            container.appendChild(toast);
            
            // Trigger animation
            setTimeout(() => toast.classList.add('show'), 10);
            
            // Auto remove
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (container.contains(toast)) {
                        container.removeChild(toast);
                    }
                }, 300);
            }, duration);
        }

        // localStorage Persistence System
        function saveState() {
            const stateToSave = {
                parkedVideos: state.parkedVideos || [],
                selectedMainTopicLeft: state.selectedMainTopicLeft,
                selectedMainTopicRight: state.selectedMainTopicRight,
                selectedMetaTagsLeft: state.selectedMetaTagsLeft || [],
                selectedMetaTagsRight: state.selectedMetaTagsRight || [],
                focusRatio: state.focusRatio,
                activeTrail: state.activeTrail,
                isTrailFeed: state.isTrailFeed
            };
            localStorage.setItem('youtubeTrailsState', JSON.stringify(stateToSave));
        }

        function loadState() {
            try {
                const saved = localStorage.getItem('youtubeTrailsState');
                if (saved) {
                    const savedState = JSON.parse(saved);
                    // Merge saved state with current state
                    Object.assign(state, savedState);
                }
            } catch (e) {
                console.log('Could not load saved state:', e);
            }
        }

        // Smart Tooltip Positioning with Edge Detection
        function initializeTooltips() {
            const tooltipElements = document.querySelectorAll('.has-tooltip-small');
            
            tooltipElements.forEach((element) => {
                element.addEventListener('mouseenter', function() {
                    const tooltip = this.querySelector('.tooltip-small');
                    if (!tooltip) return;
                    
                    // Get phone container bounds (the visible area)
                    const phoneContainer = document.querySelector('.phone-container');
                    const containerRect = phoneContainer.getBoundingClientRect();
                    const containerLeft = containerRect.left;
                    const containerRight = containerRect.right;
                    const containerWidth = containerRect.width;
                    
                    // Get element position
                    const elementRect = this.getBoundingClientRect();
                    const elementCenterX = elementRect.left + (elementRect.width / 2);
                    const elementTop = elementRect.top;
                    
                    // Show tooltip to measure it
                    tooltip.style.visibility = 'hidden';
                    tooltip.style.opacity = '0';
                    tooltip.style.display = 'block';
                    
                    const tooltipWidth = tooltip.offsetWidth;
                    const tooltipHeight = tooltip.offsetHeight;
                    
                    // Calculate ideal centered position
                    let tooltipLeft = elementCenterX - (tooltipWidth / 2);
                    const tooltipTop = elementTop - tooltipHeight - 10; // 10px gap above element
                    
                    // Edge detection and correction
                    const padding = 8; // 8px padding from container edges
                    
                    // Check left edge
                    if (tooltipLeft < containerLeft + padding) {
                        tooltipLeft = containerLeft + padding;
                    }
                    
                    // Check right edge
                    if (tooltipLeft + tooltipWidth > containerRight - padding) {
                        tooltipLeft = containerRight - padding - tooltipWidth;
                    }
                    
                    // Calculate arrow position (should point to element center)
                    const arrowLeftOffset = elementCenterX - tooltipLeft;
                    
                    // Apply positioning
                    tooltip.style.left = tooltipLeft + 'px';
                    tooltip.style.top = tooltipTop + 'px';
                    tooltip.style.opacity = '1';
                    tooltip.style.visibility = 'visible';
                    
                    // Position the arrow to point at the element
                    const arrow = tooltip.querySelector('::after') || tooltip;
                    tooltip.style.setProperty('--arrow-left', arrowLeftOffset + 'px');
                });
                
                element.addEventListener('mouseleave', function() {
                    const tooltip = this.querySelector('.tooltip-small');
                    if (tooltip) {
                        tooltip.style.opacity = '0';
                        setTimeout(() => {
                            tooltip.style.visibility = 'hidden';
                            tooltip.style.display = 'none';
                        }, 200);
                    }
                });
            });
        }

        function render() {
            document.getElementById('app').innerHTML = renderApp();
            
            // Initialize tooltips after DOM is ready
            setTimeout(() => {
                initializeTooltips();
            }, 50);
            
            // Set initial z-index for chips bar based on slider state
            setTimeout(() => {
                const chipsBar = document.querySelector('.yt-chips-bar');
                if (chipsBar) {
                    if (state.focusSliderExpanded) {
                        // Slider expanded: chips behind (lower z-index)
                        chipsBar.style.zIndex = '200';
                    } else {
                        // Slider collapsed: chips on top (higher z-index)
                        chipsBar.style.zIndex = '300';
                    }
                }
            }, 60);
            
            // Save state after render
            saveState();
            
            // Add scroll listener for topic header visibility
            if (state.isTrailFeed && !scrollListenerAdded) {
                setTimeout(() => {
                    const contentArea = document.querySelector('.yt-content');
                    if (contentArea) {
                        contentArea.addEventListener('scroll', function() {
                            const topicHeader = document.getElementById('topicHeader');
                            if (!topicHeader) return;
                            
                            const scrollTop = this.scrollTop;
                            
                            if (scrollTop > lastScrollTop && scrollTop > 30) {
                                // Scrolling down - hide header
                                topicHeader.style.opacity = '0';
                                topicHeader.style.maxHeight = '0';
                                topicHeader.style.padding = '0 16px';
                            } else if (scrollTop < lastScrollTop || scrollTop < 10) {
                                // Scrolling up or near top - show header
                                topicHeader.style.opacity = '1';
                                topicHeader.style.maxHeight = '100px';
                                topicHeader.style.padding = '12px 16px 8px 16px';
                            }
                            
                            lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
                        });
                        scrollListenerAdded = true;
                    }
                }, 100);
            } else if (!state.isTrailFeed) {
                scrollListenerAdded = false;
            }
        }

        // Load saved state and initial render
        loadState();
        render();
    </script>
</body>
</html>
